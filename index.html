<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Drop - Control Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== LOCK SCREEN ===== */
        .lock-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #1a1a2e;
            z-index: 99999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 24px;
        }

        .lock-screen.hidden { display: none; }

        .lock-logo {
            width: 60px;
            height: 60px;
            opacity: 0.9;
        }

        .lock-title {
            color: rgba(255,255,255,0.6);
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 1px;
        }

        .lock-dots {
            display: flex;
            gap: 14px;
            margin: 8px 0 20px;
        }

        .lock-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.3);
            background: transparent;
            transition: background 0.15s, border-color 0.15s;
        }

        .lock-dot.filled {
            background: #1CBBC8;
            border-color: #1CBBC8;
        }

        .lock-dot.error {
            background: #ef4444;
            border-color: #ef4444;
        }

        .lock-keypad {
            display: grid;
            grid-template-columns: repeat(3, 72px);
            gap: 12px;
        }

        .lock-key {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(255,255,255,0.05);
            color: white;
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 300;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.15s, transform 0.1s;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .lock-key:active {
            background: rgba(255,255,255,0.15);
            transform: scale(0.93);
        }

        .lock-key.empty {
            border: none;
            background: none;
            cursor: default;
        }

        .lock-key.delete {
            font-size: 1rem;
        }

        @keyframes lockShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .lock-dots.shake { animation: lockShake 0.3s ease; }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #1CBBC8;
            --accent: #1CBBC8;
            --success: #10b981;
            --warning: #f59e0b;
            --bg: #F8F9FC;
            --card-bg: #FFFFFF;
            --text: #1a1a2e;
            --text-light: #6b7280;
            --border: #E5E7EB;
            --sidebar-bg: #1a1a2e;
            --sidebar-width: 260px;
            --sidebar-collapsed: 60px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            display: flex;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            max-height: 100vh;
            background: var(--sidebar-bg);
            position: fixed;
            left: 0; top: 0; bottom: 0;
            z-index: 100;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease, transform 0.3s ease;
            overflow: hidden;
        }

        .sidebar.collapsed { width: var(--sidebar-collapsed); }

        .sidebar-header {
            padding: 20px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            min-height: 65px;
        }

        .sidebar-logo {
            font-size: 1.05rem;
            font-weight: 700;
            color: white;
            white-space: nowrap;
            transition: opacity 0.2s;
        }

        .sidebar.collapsed .sidebar-logo { opacity: 0; width: 0; }

        .toggle-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 6px;
            border-radius: 6px;
            flex-shrink: 0;
            transition: color 0.2s;
        }

        .toggle-btn:hover { color: white; }

        .sidebar-nav {
            flex: 1;
            min-height: 0;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.15) transparent;
        }
        .sidebar-nav::-webkit-scrollbar { width: 4px; }
        .sidebar-nav::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 4px; }
        .sidebar-nav::-webkit-scrollbar-track { background: transparent; }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 14px;
            border-radius: 8px;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.15s ease;
            white-space: nowrap;
            overflow: hidden;
            text-decoration: none;
            font-size: 0.82rem;
        }

        .nav-item:hover { background: rgba(255,255,255,0.06); color: #e5e7eb; }
        .nav-item.active { background: var(--primary); color: white; }

        .nav-label { font-weight: 500; transition: opacity 0.2s; white-space: normal; }
        .sidebar.collapsed .nav-label { opacity: 0; white-space: nowrap; }

        .nav-section {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #4b5563;
            padding: 12px 14px 4px;
            white-space: nowrap;
            transition: opacity 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .nav-section:hover { color: #6b7280; }

        .nav-section .chevron {
            display: inline-block;
            transition: transform 0.25s ease;
            font-size: 0.6rem;
            margin-right: 4px;
        }

        .nav-section .chevron.collapsed {
            transform: rotate(-90deg);
        }

        .nav-section-items {
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-section-items.collapsed {
            max-height: 0 !important;
        }

        .sidebar.collapsed .nav-section { opacity: 0; }

        .sidebar-footer {
            padding: 14px 16px;
            border-top: 1px solid rgba(255,255,255,0.08);
            font-size: 0.72rem;
            color: #4b5563;
            white-space: nowrap;
            transition: opacity 0.2s;
        }

        .sidebar.collapsed .sidebar-footer { opacity: 0; }

        /* ===== FAB MOBILE MENU ===== */
        .fab-menu {
            display: none;
            position: fixed;
            bottom: 24px;
            left: 24px;
            z-index: 200;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(28, 187, 200, 0.35);
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .fab-menu:active { transform: scale(0.92); }

        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.4);
            z-index: 99;
        }

        /* ===== MAIN ===== */
        .main {
            margin-left: var(--sidebar-width);
            flex: 1;
            min-width: 0;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
            padding: 35px 40px;
            overflow-x: hidden;
            box-sizing: border-box;
        }

        .sidebar.collapsed ~ .main { margin-left: var(--sidebar-collapsed); }

        .tab { display: none; }
        .tab.active { display: block; }

        .page-title {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-subtitle {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 30px;
        }

        /* ===== CARDS ===== */
        .grid { display: grid; gap: 20px; margin-bottom: 30px; max-width: 100%; }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-2 { grid-template-columns: repeat(2, 1fr); }

        .card {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 24px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            transition: transform 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .card-label {
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 12px;
        }

        .card-value {
            font-size: 2.2rem;
            font-weight: 700;
        }

        .card-value.primary { color: var(--primary); }
        .card-value.accent { color: var(--accent); }
        .card-value.success { color: var(--success); }

        .card-sub {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 6px;
        }

        .card-full { grid-column: 1 / -1; }

        /* ===== TABLES ===== */
        .table-card { overflow-x: auto; overflow-y: hidden; padding: 0; max-width: 100%; }

        .table-header {
            padding: 18px 24px;
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            font-size: 0.95rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th {
            text-align: left;
            padding: 12px 16px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-light);
            font-weight: 500;
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 12px 16px;
            font-size: 0.88rem;
            border-bottom: 1px solid var(--border);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 0;
        }

        tr:last-child td { border-bottom: none; }
        tr:hover { background: var(--bg); }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-green { background: #d1fae5; color: #065f46; }
        .badge-orange { background: #fef3c7; color: #92400e; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-gray { background: #f3f4f6; color: #4b5563; }
        .badge-purple { background: rgba(147,51,234,0.1); color: #9333ea; }

        /* ===== PROGRESS ===== */
        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease;
        }

        .progress-fill.primary { background: var(--primary); }
        .progress-fill.accent { background: var(--accent); }
        .progress-fill.success { background: var(--success); }

        /* ===== CAROUSEL ===== */
        .carousel {
            overflow-x: auto;
            scroll-behavior: smooth;
            scrollbar-width: none;
            padding-bottom: 5px;
        }

        .carousel::-webkit-scrollbar { display: none; }

        .carousel-track {
            display: flex;
            gap: 12px;
        }

        .carousel-card {
            flex: 0 0 auto;
            background: var(--card-bg);
            border-radius: 10px;
            padding: 16px 20px;
            min-width: 130px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .carousel-card .label { font-weight: 600; font-size: 0.85rem; margin-bottom: 6px; }
        .carousel-card .value { color: var(--primary); font-size: 1.5rem; font-weight: 700; }

        /* ===== FILTERS ===== */
        .filters {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 7px 16px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text-light);
            font-size: 0.82rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            font-family: 'Inter', sans-serif;
        }

        .filter-btn:hover { border-color: var(--accent); color: var(--accent); }
        .filter-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        /* ===== SESSION PROSPECTION ===== */
        .session-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #f0f2f5;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .session-container {
            width: 100%;
            max-width: 480px;
            padding: 16px 20px 16px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .session-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .session-counter {
            font-size: 0.82rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .session-close {
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--text-light);
            cursor: pointer;
            padding: 0 4px;
            line-height: 1;
        }

        .session-rappel-badge {
            background: var(--warning);
            color: white;
            font-size: 0.72rem;
            font-weight: 700;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            align-self: flex-start;
        }

        .session-company {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 4px;
        }

        .session-contact {
            font-size: 1rem;
            color: var(--text);
            margin-bottom: 2px;
        }

        .session-meta {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 16px;
        }

        .session-phone-btn {
            display: block;
            background: var(--accent);
            color: white;
            text-decoration: none;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
            padding: 16px;
            border-radius: 14px;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            transition: transform 0.1s;
        }

        .session-phone-btn:active { transform: scale(0.97); }

        .session-site-link {
            display: block;
            text-align: center;
            color: var(--accent);
            font-size: 0.85rem;
            text-decoration: none;
            margin-bottom: 16px;
            padding: 6px;
        }

        .session-script {
            background: white;
            border-radius: 14px;
            padding: 16px;
            margin-bottom: 14px;
            border: 1px solid var(--border);
        }

        .session-script.collapsed .script-body { display: none; }
        .session-script.collapsed .script-arrow { transform: rotate(-90deg); }
        .session-script.collapsed { padding-bottom: 10px; }

        .script-section { margin-bottom: 12px; }
        .script-section:last-child { margin-bottom: 0; }

        .script-label {
            font-size: 0.68rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent);
            margin-bottom: 3px;
        }

        .script-text {
            font-size: 0.85rem;
            color: var(--text);
            line-height: 1.4;
        }

        .session-note-input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            margin-bottom: 14px;
            background: white;
            outline: none;
            transition: border-color 0.2s;
        }

        .session-note-input:focus { border-color: var(--accent); }

        .session-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            position: sticky;
            bottom: 0;
            padding: 12px 0 4px;
            background: linear-gradient(to bottom, transparent, #f0f2f5 8px);
            z-index: 10;
        }

        @media (max-width: 600px) {
            .session-buttons {
                grid-template-columns: 1fr 1fr;
            }
        }

        .session-btn {
            padding: 14px 8px;
            border: none;
            border-radius: 14px;
            font-family: 'Inter', sans-serif;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            transition: transform 0.1s, opacity 0.1s;
            color: white;
        }

        .session-btn:active { transform: scale(0.95); opacity: 0.9; }

        .btn-key {
            font-size: 0.68rem;
            opacity: 0.7;
            font-weight: 400;
        }

        .btn-no-answer { background: #94a3b8; }
        .btn-not-interested { background: #ef4444; }
        .btn-callback { background: #f59e0b; }
        .btn-interested { background: #10b981; }

        .session-send-btn {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 14px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            transition: transform 0.1s;
        }

        .session-send-btn:active { transform: scale(0.97); }

        .recap-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 20px 0;
        }

        .recap-card {
            background: white;
            border-radius: 12px;
            padding: 14px 8px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .recap-number {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text);
        }

        .recap-label {
            font-size: 0.65rem;
            color: var(--text-light);
            margin-top: 2px;
        }

        .recap-details {
            background: white;
            border-radius: 14px;
            padding: 14px 16px;
            border: 1px solid var(--border);
        }

        .recap-row {
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.88rem;
        }

        .recap-row:last-child { border-bottom: none; }

        @media (max-width: 600px) {
            .session-container { padding: 12px 16px 24px; }
            .session-company { font-size: 1.3rem; }
            .recap-grid { grid-template-columns: repeat(3, 1fr); }
            .session-phone-btn { font-size: 1.1rem; padding: 14px; }
        }

        .start-session-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .start-session-btn:hover {
            box-shadow: 0 4px 14px rgba(28, 187, 200, 0.3);
            transform: translateY(-1px);
        }

        .start-session-btn:active { transform: scale(0.97); }

        /* ===== ANIMATIONS ===== */
        .fade-in {
            opacity: 0;
            transform: translateY(-12px);
            animation: fadeIn 0.4s ease forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== KANBAN ===== */
        .kanban-board {
            display: flex;
            gap: 16px;
            overflow-x: auto;
            padding-bottom: 12px;
            min-height: 400px;
            -webkit-overflow-scrolling: touch;
        }

        .kanban-board::-webkit-scrollbar { height: 6px; }
        .kanban-board::-webkit-scrollbar-track { background: var(--border); border-radius: 3px; }
        .kanban-board::-webkit-scrollbar-thumb { background: #c4c8d0; border-radius: 3px; }

        .kanban-column {
            flex: 1 1 0;
            min-width: 250px;
            background: var(--bg);
            border-radius: 12px;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            max-height: 70vh;
        }

        .kanban-column-header {
            padding: 14px 16px;
            font-weight: 600;
            font-size: 0.88rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .kanban-column-header .count {
            background: var(--border);
            color: var(--text-light);
            font-size: 0.72rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .kanban-column-body {
            padding: 10px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .kanban-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 14px 16px;
            border: 1px solid var(--border);
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
            cursor: grab;
            transition: transform 0.15s, box-shadow 0.15s;
            opacity: 0;
            transform: translateY(-12px);
            animation: fadeSlideIn 0.4s ease forwards;
        }

        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .kanban-card:active { cursor: grabbing; }

        .kanban-card-title {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 6px;
        }

        .kanban-card-desc {
            font-size: 0.78rem;
            color: var(--text-light);
            line-height: 1.4;
        }

        .kanban-card .badge {
            margin-top: 8px;
        }

        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(-12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .kanban-card:nth-child(1) { animation-delay: 0.05s; }
        .kanban-card:nth-child(2) { animation-delay: 0.1s; }
        .kanban-card:nth-child(3) { animation-delay: 0.15s; }
        .kanban-card:nth-child(4) { animation-delay: 0.2s; }
        .kanban-card:nth-child(5) { animation-delay: 0.25s; }
        .kanban-card:nth-child(6) { animation-delay: 0.3s; }

        /* Kanban column accent colors */
        .kanban-column.col-blue .kanban-column-header { border-bottom: 2px solid var(--primary); }
        .kanban-column.col-orange .kanban-column-header { border-bottom: 2px solid var(--warning); }
        .kanban-column.col-green .kanban-column-header { border-bottom: 2px solid var(--success); }
        .kanban-column.col-gray .kanban-column-header { border-bottom: 2px solid #9ca3af; }

        /* View toggle (table/kanban) */
        .view-toggle {
            display: inline-flex;
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .view-toggle-btn {
            padding: 8px 18px;
            font-size: 0.82rem;
            font-weight: 500;
            font-family: 'Inter', sans-serif;
            border: none;
            background: transparent;
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.15s;
        }

        .view-toggle-btn.active {
            background: var(--primary);
            color: white;
        }

        .view-toggle-btn:hover:not(.active) {
            background: var(--bg);
            color: var(--text);
        }

        .pipeline-view { display: none; }
        .pipeline-view.active { display: block; }

        /* Clickable marketing cards */
        .card-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .card-link .card {
            cursor: pointer;
            position: relative;
        }

        .card-link .card .link-arrow {
            position: absolute;
            top: 14px;
            right: 16px;
            font-size: 0.9rem;
            color: var(--text-light);
            transition: color 0.2s, transform 0.2s;
        }

        .card-link:hover .card .link-arrow {
            color: var(--accent);
            transform: translate(2px, -2px);
        }

        /* ===== BUSINESS TAB STYLES ===== */
        .biz-section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 18px;
            color: var(--text);
        }

        .biz-sub-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text);
        }

        .biz-list {
            list-style: none;
            padding: 0;
        }

        .biz-list li {
            padding: 8px 0;
            font-size: 0.9rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
        }

        .biz-list li:last-child { border-bottom: none; }

        .biz-list .biz-key { color: var(--text-light); font-weight: 500; }
        .biz-list .biz-val { font-weight: 600; color: var(--text); }

        .biz-service-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        .biz-service-item {
            padding: 10px 14px;
            background: var(--bg);
            border-radius: 8px;
            font-size: 0.88rem;
            font-weight: 500;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .biz-pricing-card {
            background: var(--card-bg);
            border-radius: 14px;
            padding: 24px;
            border: 1px solid var(--border);
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .biz-pricing-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }

        .biz-pricing-card .offer-name {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .biz-pricing-card .offer-price {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 12px;
        }

        .biz-pricing-card .offer-detail {
            font-size: 0.82rem;
            color: var(--text-light);
            line-height: 1.6;
        }

        .biz-pricing-card .offer-delay {
            display: inline-block;
            margin-top: 12px;
            padding: 4px 12px;
            border-radius: 20px;
            background: #dbeafe;
            color: #1e40af;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .copy-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #9ca3af;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
            transition: color 0.2s;
            vertical-align: middle;
        }
        .copy-btn:hover { color: var(--accent); }

        .biz-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
        }

        .biz-open-link {
            font-size: 0.85rem;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: color 0.2s;
        }
        .biz-open-link:hover { color: var(--accent); }

        .biz-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 9px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.9rem;
        }
        .biz-info-row:last-child { border-bottom: none; }
        .biz-info-left { display: flex; align-items: center; gap: 8px; }
        .biz-info-key { color: var(--text-light); font-weight: 500; }
        .biz-info-val { font-weight: 600; color: var(--text); }

        .biz-mini-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
        }

        .biz-mini-card {
            background: var(--bg);
            border-radius: 10px;
            padding: 18px;
            border: 1px solid var(--border);
        }

        .biz-mini-card h4 {
            font-size: 0.88rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text);
        }

        .biz-mini-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .biz-mini-card ul li {
            font-size: 0.84rem;
            color: var(--text-light);
            padding: 3px 0;
            padding-left: 14px;
            position: relative;
        }

        .biz-mini-card ul li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: 700;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
            .biz-service-grid { grid-template-columns: 1fr 1fr; }
        }

        @media (max-width: 768px) {
            .grid-4, .grid-3, .grid-2 { grid-template-columns: 1fr; }
            .biz-service-grid { grid-template-columns: 1fr; }

            .main {
                padding: 20px 16px;
                margin-left: 0 !important;
            }

            .page-title { font-size: 1.3rem; }
            .page-subtitle { font-size: 0.85rem; }
            .card-value { font-size: 1.8rem; }

            /* Bottom sheet mobile */
            .sidebar {
                width: 100vw !important;
                height: auto !important;
                max-height: 70vh;
                top: auto !important;
                bottom: 0;
                left: 0;
                right: 0;
                border-radius: 20px 20px 0 0;
                transform: translateY(100%);
                transition: transform 0.35s cubic-bezier(0.32, 0.72, 0, 1);
                box-shadow: 0 -8px 40px rgba(0,0,0,0.4);
            }

            .sidebar.mobile-open {
                transform: translateY(0);
            }

            .sidebar.collapsed {
                width: 100vw !important;
            }

            .sidebar.collapsed .nav-label,
            .sidebar.collapsed .nav-section,
            .sidebar.collapsed .sidebar-footer,
            .sidebar.collapsed .sidebar-logo {
                opacity: 1;
            }

            .sidebar-header {
                justify-content: center;
                padding: 10px 16px 4px;
                border-bottom: none;
                min-height: auto;
                flex-direction: column;
                gap: 0;
            }

            .sidebar-header::before {
                content: '';
                display: block;
                width: 36px;
                height: 4px;
                background: rgba(255,255,255,0.25);
                border-radius: 2px;
            }

            .sidebar-header .toggle-btn { display: none; }
            .sidebar-header .sidebar-logo { display: none; }

            .sidebar-nav {
                padding: 4px 8px 8px;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .sidebar-footer {
                padding: 8px 16px;
                text-align: center;
                font-size: 0.65rem;
            }

            .nav-section { padding: 8px 14px 2px; font-size: 0.6rem; }
            .nav-item { padding: 9px 14px; font-size: 0.85rem; }

            /* FAB */
            .fab-menu {
                display: flex;
            }

            .sidebar-overlay.visible {
                display: block;
            }

            /* Tables mobile */
            .table-card {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                table-layout: fixed;
                min-width: 0;
                width: 100%;
            }

            th, td {
                padding: 10px 10px;
                font-size: 0.78rem;
            }

            /* Kanban mobile */
            .kanban-board {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scroll-snap-type: x mandatory;
            }

            .kanban-column {
                min-width: 280px;
                scroll-snap-align: start;
            }

            /* Week grid mobile */
            .week-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 4px;
            }

            .week-day {
                padding: 8px 4px;
                min-height: 80px;
            }

            .week-day-label { font-size: 0.65rem; }
            .week-day-num { font-size: 1rem; }

            /* Search bar */
            .search-bar {
                flex-direction: row;
                align-items: center;
                flex-wrap: nowrap;
                gap: 8px;
                margin-bottom: 12px;
            }

            .search-input {
                flex: 1;
                min-width: 0;
                width: auto;
            }

            .search-bar .filter-btn {
                font-size: 0.72rem;
                padding: 5px 10px;
                white-space: nowrap;
            }

            .grid { margin-bottom: 20px; }
            .page-subtitle { margin-bottom: 20px; }
            .table-card { margin-bottom: 12px; }
            .card.table-card + .card.table-card { margin-top: 12px; }

            /* Pricing grid mobile */
            .biz-pricing-grid {
                grid-template-columns: 1fr !important;
            }

            /* Channels grid */
            .channels-grid-5 {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            /* Bar chart */
            .bar-chart {
                height: 150px;
            }

            .bar-label { font-size: 0.6rem; }
            .bar-amount { font-size: 0.65rem; }

            /* Sim */
            .sim-input { font-size: 1rem; }
        }

        @media (max-width: 480px) {
            .main { padding: 16px 12px; }
            .card { padding: 18px; }
            .card-value { font-size: 1.5rem; }
            .page-title { font-size: 1.15rem; }

            .week-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* ===== CLIENT PANEL ===== */
        .client-panel {
            position: fixed;
            top: 0; right: 0; bottom: 0;
            width: 420px;
            max-width: 90vw;
            background: var(--card-bg);
            border-left: 1px solid var(--border);
            box-shadow: -4px 0 24px rgba(0,0,0,0.08);
            z-index: 200;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            overflow-y: auto;
            padding: 0;
        }
        .client-panel.open { transform: translateX(0); }
        .client-panel-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 199;
            display: none;
        }
        .client-panel-overlay.visible { display: block; }

        /* ===== BAR CHART ===== */
        .bar-chart { display: flex; align-items: flex-end; gap: 8px; height: 200px; padding: 20px 0 0; }
        .bar-col { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 6px; }
        .bar-fill { width: 100%; border-radius: 6px 6px 0 0; background: var(--primary); min-height: 2px; transition: height 1s ease; }
        .bar-label { font-size: 0.7rem; color: var(--text-light); font-weight: 500; }
        .bar-amount { font-size: 0.72rem; font-weight: 600; color: var(--text); }

        /* ===== SIMULATOR ===== */
        .sim-input { width: 100%; padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px; font-size: 1.1rem; font-family: 'Inter', sans-serif; font-weight: 600; color: var(--primary); transition: border-color 0.2s; }
        .sim-input:focus { outline: none; border-color: var(--primary); }
        .sim-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .sim-row:last-child { border-bottom: none; }
        .sim-label { color: var(--text-light); }
        .sim-value { font-weight: 600; }
        .sim-value.negative { color: #ef4444; }
        .sim-value.positive { color: var(--success); }

        /* ===== SEARCH BAR ===== */
        .search-bar { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; margin-bottom: 16px; }
        .search-input { padding: 7px 14px; border-radius: 20px; border: 1px solid var(--border); background: var(--card-bg); font-size: 0.85rem; font-family: 'Inter', sans-serif; width: 220px; transition: border-color 0.2s; }
        .search-input:focus { outline: none; border-color: var(--accent); }
        .date-danger { color: #ef4444; font-weight: 600; }
        .date-warning { color: #f59e0b; font-weight: 600; }
        .date-ok { color: var(--text); }
        .wp-admin-link { display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 6px; background: var(--bg); text-decoration: none; font-size: 0.75rem; transition: background 0.2s; }
        .wp-admin-link:hover { background: var(--primary); color: white; }

        /* ===== SUB TABS ===== */
        .sub-tabs { display: flex; gap: 0; margin-bottom: 20px; border-bottom: 2px solid var(--border); }
        .sub-tab { padding: 10px 20px; font-size: 0.9rem; font-weight: 500; color: var(--text-light); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; font-family: 'Inter', sans-serif; background: none; border-top: none; border-left: none; border-right: none; }
        .sub-tab:hover { color: var(--text); }
        .sub-tab.active { color: var(--primary); border-bottom-color: var(--primary); font-weight: 600; }
        .sub-tab-content { display: none; }
        .sub-tab-content.active { display: block; }

        /* ===== LINK CARD ===== */
        a.card-link { text-decoration: none; color: inherit; display: block; }
        a.card-link .link-arrow { opacity: 0; transition: opacity 0.2s; font-size: 1.1rem; }
        a.card-link:hover .link-arrow { opacity: 1; }

        /* ===== WEEK VIEW ===== */
        .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; }
        .week-day { background: var(--card-bg); border: 1px solid var(--border); border-radius: 10px; padding: 12px; min-height: 120px; }
        .week-day.today { border-color: var(--primary); border-width: 2px; }
        .week-day-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.8px; color: var(--text-light); font-weight: 500; margin-bottom: 8px; }
        .week-day-num { font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; }

    </style>
</head>
<body>

<!-- LOCK SCREEN -->
<div class="lock-screen" id="lockScreen">
    <img src="logo.svg" class="lock-logo" alt="Pixel Drop">
    <div class="lock-title">CONTROL CENTER</div>
    <div class="lock-dots" id="lockDots">
        <div class="lock-dot"></div>
        <div class="lock-dot"></div>
        <div class="lock-dot"></div>
        <div class="lock-dot"></div>
    </div>
    <div class="lock-keypad">
        <button class="lock-key" onclick="lockInput('1')">1</button>
        <button class="lock-key" onclick="lockInput('2')">2</button>
        <button class="lock-key" onclick="lockInput('3')">3</button>
        <button class="lock-key" onclick="lockInput('4')">4</button>
        <button class="lock-key" onclick="lockInput('5')">5</button>
        <button class="lock-key" onclick="lockInput('6')">6</button>
        <button class="lock-key" onclick="lockInput('7')">7</button>
        <button class="lock-key" onclick="lockInput('8')">8</button>
        <button class="lock-key" onclick="lockInput('9')">9</button>
        <button class="lock-key empty"></button>
        <button class="lock-key" onclick="lockInput('0')">0</button>
        <button class="lock-key delete" onclick="lockDelete()">&#9003;</button>
    </div>
</div>
<script>
(function() {
    const CODE = '0239';
    const STORAGE_KEY = 'cc_auth';

    // Check if already authenticated this session
    if (sessionStorage.getItem(STORAGE_KEY) === 'ok') {
        document.getElementById('lockScreen').classList.add('hidden');
    }

    let entered = '';
    const dots = document.getElementById('lockDots').children;

    window.lockInput = function(n) {
        if (entered.length >= 4) return;
        entered += n;
        for (let i = 0; i < 4; i++) {
            dots[i].classList.toggle('filled', i < entered.length);
            dots[i].classList.remove('error');
        }
        if (entered.length === 4) {
            setTimeout(function() {
                if (entered === CODE) {
                    sessionStorage.setItem(STORAGE_KEY, 'ok');
                    document.getElementById('lockScreen').classList.add('hidden');
                } else {
                    const dotsEl = document.getElementById('lockDots');
                    for (let i = 0; i < 4; i++) {
                        dots[i].classList.remove('filled');
                        dots[i].classList.add('error');
                    }
                    dotsEl.classList.add('shake');
                    setTimeout(function() {
                        dotsEl.classList.remove('shake');
                        for (let i = 0; i < 4; i++) dots[i].classList.remove('error');
                        entered = '';
                    }, 400);
                }
            }, 150);
        }
    };

    window.lockDelete = function() {
        if (entered.length > 0) {
            entered = entered.slice(0, -1);
            for (let i = 0; i < 4; i++) {
                dots[i].classList.toggle('filled', i < entered.length);
            }
        }
    };

    // Keyboard support
    document.addEventListener('keydown', function(e) {
        if (document.getElementById('lockScreen').classList.contains('hidden')) return;
        if (e.key >= '0' && e.key <= '9') lockInput(e.key);
        else if (e.key === 'Backspace') lockDelete();
    });
})();
</script>

<!-- SIDEBAR OVERLAY (mobile) -->
<div class="sidebar-overlay" id="sidebarOverlay" onclick="closeMobileMenu()"></div>

<!-- FAB BUTTON (mobile) -->
<button class="fab-menu" id="fabMenu" onclick="toggleMobileMenu()">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
</button>

<!-- SIDEBAR -->
<nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <button class="toggle-btn" id="toggleBtn">&#9776;</button>
        <img src="logo.svg" alt="Pixel Drop" class="sidebar-logo" style="height:28px;width:auto;">
    </div>

    <div class="sidebar-nav">
        <div class="nav-section" onclick="toggleSection(this)">
            <span>General</span>
            <span class="chevron">&#9660;</span>
        </div>
        <div class="nav-section-items">
            <a class="nav-item active" onclick="switchTab('dashboard', this)">
                <span class="nav-label">Dashboard</span>
            </a>
            <a class="nav-item" onclick="switchTab('projets', this)">
                <span class="nav-label">Projets</span>
            </a>
            <a class="nav-item" onclick="switchTab('taches', this)">
                <span class="nav-label">Tâches</span>
            </a>
        </div>

        <div class="nav-section" onclick="toggleSection(this)">
            <span>Commercial</span>
            <span class="chevron">&#9660;</span>
        </div>
        <div class="nav-section-items">
            <a class="nav-item" onclick="switchTab('clients', this)">
                <span class="nav-label">Clients</span>
            </a>
            <a class="nav-item" onclick="switchTab('pipeline', this)">
                <span class="nav-label">Pipeline</span>
            </a>
            <a class="nav-item" onclick="switchTab('devis', this)">
                <span class="nav-label">Devis & Factures</span>
            </a>
        </div>

        <div class="nav-section" onclick="toggleSection(this)">
            <span>Prospection</span>
            <span class="chevron">&#9660;</span>
        </div>
        <div class="nav-section-items">
            <a class="nav-item" onclick="switchTab('prospection', this)">
                <span class="nav-label">Prospection</span>
            </a>
        </div>

        <div class="nav-section" onclick="toggleSection(this)">
            <span>Business</span>
            <span class="chevron">&#9660;</span>
        </div>
        <div class="nav-section-items">
            <a class="nav-item" onclick="switchTab('business', this)">
                <span class="nav-label">Business</span>
            </a>
            <a class="nav-item" onclick="switchTab('finances', this)">
                <span class="nav-label">Finances</span>
            </a>
            <a class="nav-item" onclick="switchTab('abonnements', this)">
                <span class="nav-label">Abonnements</span>
            </a>
        </div>

        <div class="nav-section" onclick="toggleSection(this)">
            <span>Marketing</span>
            <span class="chevron">&#9660;</span>
        </div>
        <div class="nav-section-items">
            <a class="nav-item" onclick="switchTab('marketing', this)">
                <span class="nav-label">Vue d'ensemble</span>
            </a>
            <a class="nav-item" onclick="switchTab('newsletter', this)">
                <span class="nav-label">Newsletter</span>
            </a>
            <a class="nav-item" onclick="switchTab('linkedin', this)">
                <span class="nav-label">LinkedIn</span>
            </a>
            <a class="nav-item" onclick="switchTab('instagram', this)">
                <span class="nav-label">Instagram</span>
            </a>
            <a class="nav-item" onclick="switchTab('seo', this)">
                <span class="nav-label">SEO</span>
            </a>
        </div>

        <div class="nav-section" onclick="toggleSection(this)">
            <span>Assistante</span>
            <span class="chevron">&#9660;</span>
        </div>
        <div class="nav-section-items">
            <a class="nav-item" onclick="switchTab('claudia', this)">
                <span style="margin-right: 8px;">🤖</span>
                <span class="nav-label">Claudia</span>
            </a>
        </div>

        <div class="nav-section" onclick="toggleSection(this)">
            <span>Sites</span>
            <span class="chevron">&#9660;</span>
        </div>
        <div class="nav-section-items">
            <a class="nav-item" onclick="switchTab('sites', this)">
                <span class="nav-label">Sites WordPress</span>
            </a>
            <a class="nav-item" onclick="switchTab('status', this)">
                <span class="nav-label">System Status</span>
            </a>
        </div>
    </div>

    <div class="sidebar-footer">
        <span id="clock"></span><br>
        Control Center v3.0
    </div>
</nav>

<!-- MAIN -->
<div class="main" id="main">

    <!-- ===== DASHBOARD ===== -->
    <div class="tab active" id="tab-dashboard">
        <h1 class="page-title">Dashboard</h1>
        <p class="page-subtitle" id="dash-date"></p>
        <div id="dash-content">Chargement...</div>
    </div>

    <!-- ===== PROJETS ===== -->
    <div class="tab" id="tab-projets">
        <h1 class="page-title">Projets</h1>
        <p class="page-subtitle">Projets actifs et livres (hors prospection)</p>
        <div id="projets-content">Chargement...</div>
    </div>

    <!-- ===== CLIENTS ===== -->
    <div class="tab" id="tab-clients">
        <h1 class="page-title">Clients</h1>
        <p class="page-subtitle">Base clients Pixel Drop</p>
        <div id="clients-content">Chargement...</div>
    </div>

    <!-- ===== PIPELINE ===== -->
    <div class="tab" id="tab-pipeline">
        <h1 class="page-title">Pipeline Commercial</h1>
        <p class="page-subtitle">Opportunites qualifiees — synchro Pennylane</p>
        <div id="pipeline-content">Chargement...</div>
    </div>

    <!-- ===== TÂCHES ===== -->
    <div class="tab" id="tab-taches">
        <h1 class="page-title">Tâches</h1>
        <p class="page-subtitle">Suivi des tâches en cours — Kanban</p>
        <div id="taches-content">Chargement...</div>
    </div>

    <!-- ===== CALENDRIER ===== -->
    <!-- calendrier supprime -->

    <!-- ===== PROSPECTION ===== -->
    <div class="tab" id="tab-prospection">
        <h1 class="page-title">Prospection</h1>
        <p class="page-subtitle">Suivi des sessions de prospection</p>
        <div id="prospection-content">Chargement...</div>
    </div>

    <!-- ===== BUSINESS ===== -->
    <div class="tab" id="tab-business">
        <h1 class="page-title">Business</h1>
        <p class="page-subtitle">Pixel Drop — Entreprise Individuelle</p>
        <div id="business-content"></div>
    </div>

    <!-- ===== FINANCES ===== -->
    <div class="tab" id="tab-finances">
        <h1 class="page-title">Finances</h1>
        <p class="page-subtitle">Vue financiere Pixel Drop — <a href="https://app.pennylane.com" target="_blank" style="color:var(--primary);text-decoration:none;">Ouvrir Pennylane ↗</a></p>
        <div id="finances-content">Chargement...</div>
    </div>

    <!-- ===== DEVIS & FACTURES ===== -->
    <div class="tab" id="tab-devis">
        <h1 class="page-title">Devis & Factures</h1>
        <p class="page-subtitle">Suivi Pennylane — <a href="https://app.pennylane.com" target="_blank" style="color:var(--primary);text-decoration:none;">Ouvrir Pennylane ↗</a></p>
        <div id="devis-content">Chargement...</div>
    </div>

    <!-- ===== ABONNEMENTS ===== -->
    <div class="tab" id="tab-abonnements">
        <h1 class="page-title">Abonnements</h1>
        <p class="page-subtitle">Charges fixes mensuelles</p>
        <div id="abonnements-content">Chargement...</div>
    </div>

    <!-- ===== MARKETING ===== -->
    <div class="tab" id="tab-marketing">
        <h1 class="page-title">Marketing</h1>
        <p class="page-subtitle">Progression vers les objectifs 2026</p>
        <div id="marketing-content">Chargement...</div>
    </div>

    <!-- ===== NEWSLETTER ===== -->
    <div class="tab" id="tab-newsletter">
        <h1 class="page-title">Newsletter</h1>
        <p class="page-subtitle">Campagnes Brevo - Pixel Drop</p>
        <div id="newsletter-content">Chargement...</div>
    </div>

    <!-- ===== LINKEDIN ===== -->
    <div class="tab" id="tab-linkedin">
        <h1 class="page-title">LinkedIn</h1>
        <p class="page-subtitle">Planning de publications LinkedIn</p>
        <div id="linkedin-content">Chargement...</div>
    </div>

    <!-- ===== INSTAGRAM ===== -->
    <div class="tab" id="tab-instagram">
        <h1 class="page-title">Instagram</h1>
        <p class="page-subtitle">Planning de publications Instagram</p>
        <div id="instagram-content">Chargement...</div>
    </div>

    <!-- ===== SEO ===== -->
    <div class="tab" id="tab-seo">
        <h1 class="page-title">SEO</h1>
        <p class="page-subtitle">pixel-drop.com - Search Console</p>
        <div id="seo-content">Chargement...</div>
    </div>

    <!-- ===== SITES WORDPRESS ===== -->
    <div class="tab" id="tab-sites">
        <h1 class="page-title">Sites WordPress</h1>
        <p class="page-subtitle">Statut et maintenance des sites clients</p>
        <div id="sites-content">Chargement...</div>
    </div>

    <!-- ===== SYSTEM STATUS ===== -->
    <div class="tab" id="tab-status">
        <h1 class="page-title">System Status</h1>
        <p class="page-subtitle">État de tous les services en temps réel</p>
        <div id="status-content">Chargement...</div>
    </div>

    <!-- ===== CLAUDIA ===== -->
    <div class="tab" id="tab-claudia">
        <h1 class="page-title">Claudia</h1>
        <p class="page-subtitle">État de tous les systèmes automatisés</p>
        
        <!-- SECTION 1: Heartbeats (3 agents seulement, PAS Jarvis) -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:10px;">Heartbeats</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;" id="heartbeats-grid">
            <!-- Claudia (Main) -->
            <div class="card fade-in" style="animation-delay:0.1s; padding: 24px; background: var(--card-bg); border-radius: 12px; position: relative;">
                <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; position: absolute; top: 12px; right: 12px; animation: pulse 2s infinite;"></div>
                <h3 style="margin: 0 0 8px 0; font-weight: 700; font-size: 1rem;">Claudia (Main)</h3>
                <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 8px; font-weight: 600;">Toutes les 30 min</div>
                <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 4px;">Model heartbeat : Claude Sonnet 4</div>
                <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 12px;">Model principal : Claude Opus 4.6</div>
                <div style="font-size: 0.8rem; color: var(--text); margin-bottom: 8px; font-weight: 600;">Ce qu'elle check :</div>
                <ul style="margin: 0; padding-left: 16px; font-size: 0.75rem; color: var(--text-light);">
                    <li>Emails (contact@ + claudia@)</li>
                    <li>Calendrier Apple</li>
                    <li>WhatsApp en attente</li>
                    <li>Pipeline CRM</li>
                    <li>Événements passés</li>
                </ul>
                <div style="margin-top: 12px; font-size: 0.7rem; color: var(--text-light); font-style: italic;">Style : Pepper Potts, attentionnée</div>
                <div style="margin-top: 8px; font-size: 0.7rem; color: var(--text-light);" id="main-last-check">Dernier check : --</div>
            </div>

            <!-- Valentina (Plaza Marketing) -->
            <div class="card fade-in" style="animation-delay:0.15s; padding: 24px; background: var(--card-bg); border-radius: 12px; position: relative;">
                <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; position: absolute; top: 12px; right: 12px; animation: pulse 2s infinite;"></div>
                <h3 style="margin: 0 0 8px 0; font-weight: 700; font-size: 1rem;">Valentina (Plaza Marketing)</h3>
                <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 8px; font-weight: 600;">Toutes les 15 min</div>
                <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 4px;">Model heartbeat : Claude Haiku 3.5</div>
                <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 12px;">Model principal : Claude Opus 4.5</div>
                <div style="font-size: 0.8rem; color: var(--text); margin-bottom: 8px; font-weight: 600;">Ce qu'elle check :</div>
                <ul style="margin: 0; padding-left: 16px; font-size: 0.75rem; color: var(--text-light);">
                    <li>Ventes Stripe</li>
                    <li>Emails valentina@</li>
                    <li>Posts Instagram prévus</li>
                    <li>Dashboard sync</li>
                </ul>
                <div style="margin-top: 12px; font-size: 0.7rem; color: var(--warning); font-style: italic;">Note : HEARTBEAT.md vide actuellement (à configurer)</div>
                <div style="margin-top: 8px; font-size: 0.7rem; color: var(--text-light);" id="plaza-last-check">Dernier check : --</div>
            </div>

            <!-- Clea -->
            <div class="card fade-in" style="animation-delay:0.2s; padding: 24px; background: var(--card-bg); border-radius: 12px; position: relative;">
                <div style="width: 12px; height: 12px; background: #10b981; border-radius: 50%; position: absolute; top: 12px; right: 12px; animation: pulse 2s infinite;"></div>
                <h3 style="margin: 0 0 8px 0; font-weight: 700; font-size: 1rem;">Clea</h3>
                <div style="font-size: 0.85rem; color: var(--primary); margin-bottom: 8px; font-weight: 600;">Toutes les 30 min</div>
                <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 4px;">Model heartbeat : Claude Haiku 3.5</div>
                <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 12px;">Model principal : Claude Opus 4.5</div>
                <div style="font-size: 0.8rem; color: var(--text); margin-bottom: 8px; font-weight: 600;">Ce qu'elle check :</div>
                <ul style="margin: 0; padding-left: 16px; font-size: 0.75rem; color: var(--text-light);">
                    <li>Posts prévus</li>
                    <li>Stats semaine</li>
                    <li>Veille concurrentielle</li>
                    <li>Tendances LinkedIn</li>
                </ul>
                <div style="margin-top: 12px; font-size: 0.7rem; color: var(--text-light);" id="clea-last-check">Dernier check : --</div>
            </div>
        </div>

        <!-- Styles pour responsive heartbeats et badges canaux -->
        <style>
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.3; }
            }
            @media (max-width: 768px) {
                #heartbeats-grid { grid-template-columns: 1fr !important; }
                #usage-grid { grid-template-columns: repeat(2, 1fr) !important; }
            }

            /* Badges canaux */
            .channel-badge {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 0.7rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-right: 4px;
            }

            .channel-imessage {
                background: #007AFF;
                color: white;
            }

            .channel-telegram {
                background: #0088CC;
                color: white;
            }

            .channel-email {
                background: #FF9500;
                color: white;
            }

            .channel-silent {
                background: #8E8E93;
                color: white;
            }

            /* Activité récente styles */
            .activity-item {
                display: flex;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .activity-item:last-child {
                border-bottom: none;
            }

            .activity-time {
                font-size: 0.75rem;
                color: var(--text-light);
                min-width: 45px;
                margin-right: 12px;
            }

            .activity-agent {
                display: inline-block;
                padding: 2px 6px;
                border-radius: 8px;
                font-size: 0.7rem;
                font-weight: 600;
                margin-right: 8px;
                min-width: 60px;
                text-align: center;
            }

            .agent-claudia { background: rgba(28, 187, 200, 0.2); color: #1CBBC8; }
            .agent-valentina { background: rgba(255, 149, 0, 0.2); color: #FF9500; }
            .agent-clea { background: rgba(88, 86, 214, 0.2); color: #5856D6; }

            .activity-action {
                flex: 1;
                font-size: 0.8rem;
                color: var(--text);
            }
        </style>

        <!-- SECTION 2: Usage du jour -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Usage du jour</h2>
        <div class="grid grid-4 fade-in" style="animation-delay:0.25s" id="usage-grid">
            <div class="card">
                <div class="card-label">Tokens entrants</div>
                <div class="card-value accent" style="font-size:1.8rem;" id="tokens-input">--</div>
                <div class="card-sub">Aujourd'hui</div>
            </div>
            <div class="card">
                <div class="card-label">Tokens sortants</div>
                <div class="card-value accent" style="font-size:1.8rem;" id="tokens-output">--</div>
                <div class="card-sub">Aujourd'hui</div>
            </div>
            <div class="card">
                <div class="card-label">Coût estimé</div>
                <div class="card-value primary" style="font-size:1.8rem;" id="tokens-cost">--</div>
                <div class="card-sub">Aujourd'hui</div>
            </div>
            <div class="card">
                <div class="card-label">Messages envoyés</div>
                <div class="card-value success" style="font-size:1.8rem;" id="messages-sent">--</div>
                <div class="card-sub">Aujourd'hui</div>
            </div>
        </div>

        <!-- SECTION 3: Activité récente -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Activité récente</h2>
        <div class="card fade-in" style="animation-delay:0.3s; padding: 20px;" id="recent-activity">
            <div style="color: var(--text-light); font-size: 0.9rem; text-align: center; padding: 20px;">
                Sync en cours...
            </div>
        </div>

        <!-- SECTION 4: Crons Quotidiens -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Crons Quotidiens</h2>
        <div class="card table-card fade-in" style="animation-delay:0.4s">
            <div class="table-header">Tâches automatisées quotidiennes</div>
            <table>
                <thead><tr><th>Nom</th><th>Horaire</th><th>Description</th><th>Canal</th></tr></thead>
                <tbody>
                    <tr><td>Auto-update</td><td>5h</td><td>MAJ Clawdbot + skills</td><td><span class="channel-badge channel-silent">Silencieux</span></td></tr>
                    <tr><td>Briefing matin</td><td>8h</td><td>Emails, RDV, WhatsApp, pipeline</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Update Control Center</td><td>8h 14h 20h</td><td>Sync dashboard</td><td><span class="channel-badge channel-silent">Silencieux</span></td></tr>
                    <tr><td>Kick-ass Board</td><td>9h lun-ven</td><td>Motivation + action</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Check mi-journée</td><td>13h lun-ven</td><td>Emails, rappels</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Recap soir</td><td>18h lun-ven</td><td>Bilan + RDV demain</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Dashboard DerniereDispo</td><td>20h</td><td>Sync dashboard</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                </tbody>
            </table>
        </div>

        <!-- SECTION 5: Crons Hebdo & Mensuels -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Crons Hebdo & Mensuels</h2>
        <div class="card table-card fade-in" style="animation-delay:0.5s">
            <div class="table-header">Tâches automatisées périodiques</div>
            <table>
                <thead><tr><th>Nom</th><th>Fréquence</th><th>Description</th><th>Canal</th></tr></thead>
                <tbody>
                    <tr><td>Prospection auto</td><td>Lundi 4h</td><td>10 PME via Pappers</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Check Brevo DerniereDispo</td><td>Lundi 9h</td><td>Adresses bloquées</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Rapport hebdo Plaza</td><td>Lundi 10h</td><td>Stats semaine</td><td><span class="channel-badge channel-email">Email</span></td></tr>
                    <tr><td>Blog Plaza</td><td>Jeudi 10h</td><td>Article SEO auto</td><td><span class="channel-badge channel-telegram">Telegram</span> + <span class="channel-badge channel-email">Email</span></td></tr>
                    <tr><td>Upsell clients</td><td>1er du mois</td><td>Contrats à renouveler</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Audit SEO</td><td>15 du mois</td><td>pixel-drop.com</td><td><span class="channel-badge channel-email">Email</span></td></tr>
                </tbody>
            </table>
        </div>

        <!-- SECTION 6: Crons Plaza Tango -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Crons Plaza Tango</h2>
        <div class="card table-card fade-in" style="animation-delay:0.6s">
            <div class="table-header">Automatisations spécifiques Plaza Tango</div>
            <table>
                <thead><tr><th>Nom</th><th>Fréquence</th><th>Description</th><th>Canal</th></tr></thead>
                <tbody>
                    <tr><td>Check Stripe</td><td>/30min</td><td>Nouvelles ventes</td><td><span class="channel-badge channel-telegram">Telegram</span></td></tr>
                    <tr><td>Check emails Valentina</td><td>/1h</td><td>Emails importants</td><td><span class="channel-badge channel-telegram">Telegram</span></td></tr>
                    <tr><td>Sync dashboard</td><td>/2h</td><td>GitHub Pages</td><td><span class="channel-badge channel-silent">Silencieux</span></td></tr>
                    <tr><td>Brief Instagram</td><td>9h</td><td>Post du jour</td><td><span class="channel-badge channel-imessage">iMessage</span></td></tr>
                    <tr><td>Recap soir Plaza</td><td>20h</td><td>Bilan ventes</td><td><span class="channel-badge channel-telegram">Telegram</span></td></tr>
                </tbody>
            </table>
        </div>

        <!-- SECTION 5: Dashboards -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Dashboards</h2>
        <div class="grid grid-3 fade-in" style="animation-delay:0.6s">
            <a href="https://real-pixeldrop.github.io/command-center/" target="_blank" class="card-link">
                <div class="card">
                    <span class="link-arrow">↗</span>
                    <div class="card-label">Control Center</div>
                    <div class="card-value primary" style="font-size:1.4rem;">Control Center</div>
                    <div class="card-sub">real-pixeldrop.github.io/command-center/</div>
                </div>
            </a>
            <a href="https://real-pixeldrop.github.io/plaza-tango-generator/" target="_blank" class="card-link">
                <div class="card">
                    <span class="link-arrow">↗</span>
                    <div class="card-label">Plaza Tango</div>
                    <div class="card-value primary" style="font-size:1.4rem;">Plaza Tango</div>
                    <div class="card-sub">real-pixeldrop.github.io/plaza-tango-generator/</div>
                </div>
            </a>
            <a href="https://real-pixeldrop.github.io/derniere-dispo-dashboard/" target="_blank" class="card-link">
                <div class="card">
                    <span class="link-arrow">↗</span>
                    <div class="card-label">DerniereDispo</div>
                    <div class="card-value primary" style="font-size:1.4rem;">DerniereDispo</div>
                    <div class="card-sub">real-pixeldrop.github.io/derniere-dispo-dashboard/</div>
                </div>
            </a>
        </div>

        <!-- SECTION 6: Canaux de communication -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Canaux de communication</h2>
        <div class="grid grid-2 fade-in" style="animation-delay:0.7s">
            <div class="card">
                <div class="card-label">iMessage (Claudia)</div>
                <div class="card-value accent" style="font-size:1.4rem;">📱 Principal</div>
                <div class="card-sub">Canal principal avec Akli</div>
                <span class="badge badge-green" style="margin-top:8px;">Connecté</span>
            </div>
            <div class="card">
                <div class="card-label">Telegram</div>
                <div class="card-value accent" style="font-size:1.4rem;">🤖 Agents</div>
                <div class="card-sub">Agents secondaires (Valentina, Jarvis, Mike, etc.)</div>
                <span class="badge badge-green" style="margin-top:8px;">Connecté</span>
            </div>
        </div>

        <!-- SECTION 7: Mes Agents (EN DERNIER) -->
        <h2 style="font-size:1.2rem; margin-bottom:18px; margin-top:30px;">Mes Agents</h2>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;" id="agents-grid">
            <!-- Agent 1: CLAUDIA -->
            <div class="card agent-card fade-in" style="animation-delay:0.1s; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-radius: 12px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: #1CBBC8; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.3rem; flex-shrink: 0;">C</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 4px 0; font-weight: 700;">CLAUDIA</h3>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Assistante personnelle</small>
                    </div>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 12px; line-height: 1.4; color: var(--text);">Gestion complete : emails, calendrier, CRM, pipeline, prospection, coaching. Canal principal iMessage.</p>
                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 12px; padding: 6px 10px; background: rgba(28, 187, 200, 0.1); border-radius: 6px;">
                    Model : Claude Opus 4.6
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;">
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">emails</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">calendrier</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">CRM Notion</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">WhatsApp</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">Pennylane</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">web</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">fichiers</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://t.me/akli_ia_bot" target="_blank" style="color: var(--primary); text-decoration: none; font-size: 0.85rem; padding: 4px 8px; border: 1px solid var(--primary); border-radius: 6px; display: inline-flex; align-items: center; gap: 4px; transition: background 0.2s;">
                        ✈ Telegram
                    </a>
                    <span style="background: rgba(16, 185, 129, 0.15); color: #10b981; font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; font-weight: 600;">30min</span>
                </div>
            </div>

            <!-- Agent 2: VALENTINA -->
            <div class="card agent-card fade-in" style="animation-delay:0.2s; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-radius: 12px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: #e91e63; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.3rem; flex-shrink: 0;">V</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 4px 0; font-weight: 700;">VALENTINA</h3>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Marketing Plaza Tango</small>
                    </div>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 12px; line-height: 1.4; color: var(--text);">Strategie marketing festival : Instagram, newsletters Brevo, blog WordPress, suivi Stripe, dashboard.</p>
                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 12px; padding: 6px 10px; background: rgba(233, 30, 99, 0.1); border-radius: 6px;">
                    Model : Claude Opus 4.5
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;">
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">web</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">fichiers</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">emails</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">Stripe</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">Brevo</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">WordPress</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">browser</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://t.me/valentina_marketing_akli_bot" target="_blank" style="color: var(--primary); text-decoration: none; font-size: 0.85rem; padding: 4px 8px; border: 1px solid var(--primary); border-radius: 6px; display: inline-flex; align-items: center; gap: 4px; transition: background 0.2s;">
                        ✈ Telegram
                    </a>
                    <span style="background: rgba(16, 185, 129, 0.15); color: #10b981; font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; font-weight: 600;">15min</span>
                </div>
            </div>

            <!-- Agent 3: CLEA -->
            <div class="card agent-card fade-in" style="animation-delay:0.3s; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-radius: 12px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: #9c27b0; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.3rem; flex-shrink: 0;">C</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 4px 0; font-weight: 700;">CLEA</h3>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Marketing Pixel Drop</small>
                    </div>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 12px; line-height: 1.4; color: var(--text);">Visibilite Pixel Drop : contenu, leads, branding, communication digitale.</p>
                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 12px; padding: 6px 10px; background: rgba(156, 39, 176, 0.1); border-radius: 6px;">
                    Model : Claude Opus 4.5
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;">
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">web</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">fichiers</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">emails</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">browser</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://t.me/clea_pixeldrop_bot" target="_blank" style="color: var(--primary); text-decoration: none; font-size: 0.85rem; padding: 4px 8px; border: 1px solid var(--primary); border-radius: 6px; display: inline-flex; align-items: center; gap: 4px; transition: background 0.2s;">
                        ✈ Telegram
                    </a>
                    <span style="background: rgba(16, 185, 129, 0.15); color: #10b981; font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; font-weight: 600;">30min</span>
                </div>
            </div>

            <!-- Agent 4: JARVIS -->
            <div class="card agent-card fade-in" style="animation-delay:0.4s; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-radius: 12px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: #607d8b; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.3rem; flex-shrink: 0;">J</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 4px 0; font-weight: 700;">JARVIS</h3>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Majordome personnel</small>
                    </div>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 12px; line-height: 1.4; color: var(--text);">Assistant formel style majordome britannique. Vouvoie, anticipe, execute avec discretion.</p>
                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 12px; padding: 6px 10px; background: rgba(96, 125, 139, 0.1); border-radius: 6px;">
                    Model : Claude Opus 4.6 (hérité default)
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;">
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">tous (hérité defaults)</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://t.me/jarvis_akli_bot" target="_blank" style="color: var(--primary); text-decoration: none; font-size: 0.85rem; padding: 4px 8px; border: 1px solid var(--primary); border-radius: 6px; display: inline-flex; align-items: center; gap: 4px; transition: background 0.2s;">
                        ✈ Telegram
                    </a>
                    <span style="background: #f3f4f6; color: #4b5563; font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; font-weight: 600;">Inactif</span>
                </div>
            </div>

            <!-- Agent 5: MIKE -->
            <div class="card agent-card fade-in" style="animation-delay:0.5s; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-radius: 12px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: #ff5722; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.3rem; flex-shrink: 0;">M</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 4px 0; font-weight: 700;">MIKE</h3>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Coach muscu Heavy Duty</small>
                    </div>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 12px; line-height: 1.4; color: var(--text);">Coaching musculation style Mike Mentzer. Suivi seances, nutrition, progression. Parle en anglais.</p>
                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 12px; padding: 6px 10px; background: rgba(255, 87, 34, 0.1); border-radius: 6px;">
                    Model : Claude Opus 4.6 (hérité default)
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;">
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">web</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">fichiers</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">exec</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">messages</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">cron</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://t.me/mike_akli_bot" target="_blank" style="color: var(--primary); text-decoration: none; font-size: 0.85rem; padding: 4px 8px; border: 1px solid var(--primary); border-radius: 6px; display: inline-flex; align-items: center; gap: 4px; transition: background 0.2s;">
                        ✈ Telegram
                    </a>
                    <span style="background: #f3f4f6; color: #4b5563; font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; font-weight: 600;">Inactif</span>
                </div>
            </div>

            <!-- Agent 6: DONALD -->
            <div class="card agent-card fade-in" style="animation-delay:0.6s; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-radius: 12px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: #f44336; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.3rem; flex-shrink: 0;">D</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 4px 0; font-weight: 700;">DONALD</h3>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Sparring partner business</small>
                    </div>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 12px; line-height: 1.4; color: var(--text);">Challenge les pitchs, negocie dur, trouve les failles. Style Trump : confiance absolue.</p>
                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 12px; padding: 6px 10px; background: rgba(244, 67, 54, 0.1); border-radius: 6px;">
                    Model : Claude Opus 4.6 (hérité default)
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;">
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">web</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">fichiers</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">exec</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://t.me/trump_akli_bot" target="_blank" style="color: var(--primary); text-decoration: none; font-size: 0.85rem; padding: 4px 8px; border: 1px solid var(--primary); border-radius: 6px; display: inline-flex; align-items: center; gap: 4px; transition: background 0.2s;">
                        ✈ Telegram
                    </a>
                    <span style="background: #f3f4f6; color: #4b5563; font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; font-weight: 600;">Inactif</span>
                </div>
            </div>

            <!-- Agent 7: ALMA -->
            <div class="card agent-card fade-in" style="animation-delay:0.7s; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); border-radius: 12px;">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <div style="width: 56px; height: 56px; border-radius: 50%; background: #8bc34a; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.3rem; flex-shrink: 0;">A</div>
                    <div style="flex: 1; min-width: 0;">
                        <h3 style="margin: 0 0 4px 0; font-weight: 700;">ALMA</h3>
                        <small style="color: var(--text-light); font-size: 0.85rem;">Accompagnante psychologique</small>
                    </div>
                </div>
                <p style="font-size: 0.9rem; margin-bottom: 12px; line-height: 1.4; color: var(--text);">Ecoute active, questions ouvertes, confrontation bienveillante. Aide a explorer les patterns.</p>
                <div style="font-size: 0.8rem; color: var(--text-light); margin-bottom: 12px; padding: 6px 10px; background: rgba(139, 195, 74, 0.1); border-radius: 6px;">
                    Model : Claude Opus 4.6 (hérité default)
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 4px; margin-bottom: 12px;">
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">web</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">memoire</span>
                    <span style="background: #f0f0f0; border-radius: 4px; padding: 2px 8px; font-size: 0.7rem; color: var(--text);">fichiers</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a href="https://t.me/alma_akli_bot" target="_blank" style="color: var(--primary); text-decoration: none; font-size: 0.85rem; padding: 4px 8px; border: 1px solid var(--primary); border-radius: 6px; display: inline-flex; align-items: center; gap: 4px; transition: background 0.2s;">
                        ✈ Telegram
                    </a>
                    <span style="background: #f3f4f6; color: #4b5563; font-size: 0.75rem; padding: 3px 8px; border-radius: 10px; font-weight: 600;">Inactif</span>
                </div>
            </div>
        </div>

        <!-- Styles pour responsive -->
        <style>
            @media (max-width: 1200px) {
                #agents-grid { grid-template-columns: repeat(2, 1fr) !important; }
            }
            @media (max-width: 768px) {
                #agents-grid { grid-template-columns: 1fr !important; }
            }
        </style>
    </div>

</div>

<script>
    let DATA = {};

    // ===== LOAD DATA =====
    fetch('data.json')
        .then(r => r.json())
        .then(d => { DATA = d; renderAll(); })
        .catch(e => console.error('Erreur chargement data.json:', e));

    // ===== UTILITY =====
    function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
    function fmtDate(s) { if (!s) return '--'; const parts = s.split('-'); if (parts.length === 3) return parts[2] + '-' + parts[1] + '-' + parts[0]; return s; }

    function badgeClass(statut) {
        const s = statut.toLowerCase();
        if (s.includes('retard') || s.includes('danger')) return 'badge-red';
        if (s.includes('en cours') || s.includes('nouveau') || s.includes('contacter') || s.includes('rappeler') || s.includes('mail')) return 'badge-blue';
        if (s.includes('livre') || s.includes('actif') || s.includes('active') || s.includes('accepte') || s.includes('payee') || s.includes('signe') || s.includes('termine')) return 'badge-green';
        if (s.includes('attente') || s.includes('projet en cours') || s.includes('discussion')) return 'badge-orange';
        if (s.includes('ancien') || s.includes('non') || s.includes('perdu') || s.includes('interesse')) return 'badge-gray';
        return 'badge-blue';
    }

    function dateClass(dateStr) {
        if (!dateStr || dateStr === '--') return 'date-ok';
        const parts = dateStr.split('/');
        if (parts.length < 3) return 'date-ok';
        const d = new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0]));
        const now = new Date();
        const diffMs = d - now;
        const diffMonths = diffMs / (1000 * 60 * 60 * 24 * 30);
        if (diffMonths < 3) return 'date-danger';
        if (diffMonths < 5) return 'date-warning';
        return 'date-ok';
    }

    function majStyle(val) {
        const n = parseInt(val);
        if (isNaN(n)) return '';
        if (n >= 9) return 'color:#ef4444;font-weight:600';
        if (n >= 7) return 'color:#f59e0b;font-weight:600';
        return '';
    }

    // ===== RENDER ALL =====
    function renderAll() {
        renderDashboard();
        renderProjets();
        renderClients();
        renderPipeline();
        renderTaches();
        renderProspection();
        renderBusiness();
        renderFinances();
        renderDevis();
        renderAbonnements();
        renderMarketing();
        renderNewsletter();
        renderLinkedin();
        renderInstagram();
        renderSEO();
        renderSites();
        renderStatus();
    }

    // ===== HELPERS: OBJECTIFS & RELANCES =====
    function getObjectifMensuel() {
        const now = new Date();
        const moisNoms = ['Janvier','Fevrier','Mars','Avril','Mai','Juin','Juillet','Aout','Septembre','Octobre','Novembre','Decembre'];
        const currentMonthIdx = now.getMonth();
        const chart = DATA.finances.ca_mensuel_chart;
        const caActuel = (chart[currentMonthIdx] && chart[currentMonthIdx].montant !== null) ? chart[currentMonthIdx].montant : 0;
        const objectif = DATA.objectifs.ca_mensuel;
        const pct = objectif > 0 ? Math.min(100, Math.round(caActuel / objectif * 100)) : 0;
        const color = pct >= 80 ? 'var(--success)' : pct >= 50 ? 'var(--warning)' : '#ef4444';
        return { mois: moisNoms[currentMonthIdx], caActuel, objectif, pct, color };
    }

    function getRelances() {
        const now = new Date();
        const devis = DATA.devis || [];
        return devis.filter(d => {
            const s = d.statut.toLowerCase();
            if (s !== 'en attente' && s !== 'envoye' && s !== 'envoyé') return false;
            if (!d.date_envoi) return false;
            const envoi = new Date(d.date_envoi);
            const jours = Math.floor((now - envoi) / (1000 * 60 * 60 * 24));
            return jours > 7;
        }).map(d => {
            const envoi = new Date(d.date_envoi);
            const jours = Math.floor((now - envoi) / (1000 * 60 * 60 * 24));
            return { ...d, jours };
        }).sort((a, b) => b.jours - a.jours);
    }

    // ===== DASHBOARD =====
    function renderDashboard() {
        const k = DATA.kpis;
        const m = DATA.marketing;
        const dp = DATA.dash_projets_en_cours;
        const pl = DATA.dash_planning;
        const liPct = Math.round(m.linkedin.current / m.linkedin.goal * 100);
        const igPct = Math.round(m.instagram.current / m.instagram.goal * 100);
        const nlPct = Math.min(100, Math.round(m.newsletter.current / m.newsletter.goal * 100));
        const trPct = Math.round(m.trafic.current / m.trafic.goal * 100 * 10) / 10;

        const caNum = parseInt(DATA.finances.total_2026.replace(/[^0-9]/g, '')) || 0;
        const caPct = Math.round(caNum / 100000 * 100);

        const tachesEnCours = DATA.taches.filter(t => t.colonne === 'en_cours' || t.colonne === 'a_faire');
        const tacheRows = tachesEnCours.slice(0, 8).map(t =>
            `<tr onclick="openTachePanel('${esc(t.titre).replace(/'/g, "\\'")}')" style="cursor:pointer"><td>${esc(t.titre)}</td><td><span class="badge badge-${t.badge_color}">${esc(t.badge)}</span></td></tr>`
        ).join('');

        let projRows = dp.map(p => {
            const pL = p.projet.toLowerCase(), cL = (p.client||'').toLowerCase();
            const matchP = DATA.projets.find(pr => pr.nom === p.projet || pr.client === p.client || pr.nom.toLowerCase().includes(pL) || pL.includes(pr.nom.toLowerCase()) || pr.client.toLowerCase().includes(cL) || cL.includes(pr.client.toLowerCase()));
            const pNom = matchP ? matchP.nom : p.projet;
            return `<tr onclick="openProjetPanel('${esc(pNom).replace(/'/g, "\\'")}')" style="cursor:pointer"><td>${esc(p.projet)}</td><td>${esc(p.client)}</td><td><span class="badge ${badgeClass(p.statut)}">${esc(p.statut)}</span></td></tr>`;
        }).join('');

        const moisNoms = ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];
        const currentMonthIdx = new Date().getMonth();
        const caChart = DATA.finances.ca_mensuel_chart;

        // Objectif mensuel
        const obj = getObjectifMensuel();
        const caActuelFmt = obj.caActuel.toLocaleString('fr-FR');
        const objFmt = obj.objectif.toLocaleString('fr-FR');

        // Relances
        const relances = getRelances();
        const relanceCount = relances.length;
        const relanceColor = relanceCount > 0 ? '#ef4444' : 'var(--success)';

        document.getElementById('dash-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s;cursor:pointer;" onclick="switchTab('finances', document.querySelector('[onclick*=finances]'))">
                <div class="card-label">Objectif ${esc(obj.mois)}</div>
                <div style="display:flex;justify-content:space-between;align-items:baseline;margin:8px 0 4px;">
                    <span class="card-value" style="font-size:1.3rem;">${caActuelFmt}€</span>
                    <span style="color:var(--text-light);font-size:0.85rem;">/ ${objFmt}€</span>
                </div>
                <div style="background:var(--border);border-radius:8px;height:8px;overflow:hidden;">
                    <div style="background:${obj.color};height:100%;width:${obj.pct}%;border-radius:8px;transition:width 0.5s ease;"></div>
                </div>
                <div style="text-align:right;font-size:0.78rem;color:var(--text-light);margin-top:4px;">${obj.pct}%</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s;cursor:pointer;" onclick="switchTab('finances', document.querySelector('[onclick*=finances]'))">
                <div class="card-label">CA annuel 2026</div>
                <div class="card-value accent">${esc(DATA.finances.total_2026)}</div>
                <div class="card-sub">objectif : 100 000€</div>
                <div class="progress-bar" style="margin-top:10px;"><div class="progress-fill accent" style="width:${caPct}%"></div></div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s;cursor:pointer;" onclick="switchTab('devis', document.querySelector('[onclick*=devis]'))">
                <div class="card-label">Devis en attente</div>
                <div class="card-value accent">${DATA.devis_kpis.en_attente.count}</div>
                <div class="card-sub">${esc(DATA.devis_kpis.en_attente.montant)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s;cursor:pointer;" onclick="switchTab('devis', document.querySelector('[onclick*=devis]'))">
                <div class="card-label">Relances</div>
                <div class="card-value" style="color:${relanceColor};">${relanceCount}</div>
                <div class="card-sub">${relanceCount > 0 ? 'devis sans reponse > 7j' : 'aucune relance'}</div>
            </div>
        </div>

        <h2 style="font-size:1.2rem; margin-bottom:18px;">Marketing</h2>
        <div class="grid grid-4">
            <a href="${esc(m.linkedin.url)}" target="_blank" class="card-link">
                <div class="card fade-in" style="animation-delay:0.3s">
                    <span class="link-arrow">↗</span>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                        <span style="font-weight:600;font-size:0.85rem;">LinkedIn</span>
                        <span style="color:var(--accent);font-weight:600;font-size:0.85rem;">${m.linkedin.current} / ${m.linkedin.goal}</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill accent" style="width:${liPct}%"></div></div>
                </div>
            </a>
            <a href="${esc(m.instagram.url)}" target="_blank" class="card-link">
                <div class="card fade-in" style="animation-delay:0.35s">
                    <span class="link-arrow">↗</span>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                        <span style="font-weight:600;font-size:0.85rem;">Instagram</span>
                        <span style="color:var(--accent);font-weight:600;font-size:0.85rem;">${m.instagram.current} / ${m.instagram.goal}</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill accent" style="width:${igPct}%"></div></div>
                </div>
            </a>
            <a href="${esc(m.newsletter.url)}" target="_blank" class="card-link">
                <div class="card fade-in" style="animation-delay:0.4s">
                    <span class="link-arrow">↗</span>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                        <span style="font-weight:600;font-size:0.85rem;">Newsletter</span>
                        <span style="color:var(--accent);font-weight:600;font-size:0.85rem;">${m.newsletter.current} / ${m.newsletter.goal}</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill accent" style="width:${nlPct}%"></div></div>
                </div>
            </a>
            <a href="${esc(m.trafic.url)}" target="_blank" class="card-link">
                <div class="card fade-in" style="animation-delay:0.45s">
                    <span class="link-arrow">↗</span>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                        <span style="font-weight:600;font-size:0.85rem;">Trafic 30j</span>
                        <span style="color:var(--accent);font-weight:600;font-size:0.85rem;">${m.trafic.current} / ${m.trafic.goal}</span>
                    </div>
                    <div class="progress-bar"><div class="progress-fill accent" style="width:${trPct}%"></div></div>
                </div>
            </a>
        </div>

        <div class="grid grid-2">
            <div class="card table-card fade-in" style="animation-delay:0.5s">
                <div class="table-header" style="cursor:pointer;" onclick="switchTab('projets', document.querySelector('[onclick*=projets]'))">Projets en cours <span style="font-size:0.75rem;opacity:0.5;">→</span></div>
                <table>
                    <thead><tr><th>Projet</th><th>Client</th><th>Statut</th></tr></thead>
                    <tbody>${projRows}</tbody>
                </table>
            </div>
            <div class="card table-card fade-in" style="animation-delay:0.35s">
                <div class="table-header" style="cursor:pointer;" onclick="switchTab('taches', document.querySelector('[onclick*=taches]'))">Taches en cours <span style="font-size:0.75rem;opacity:0.5;">→</span></div>
                <table>
                    <thead><tr><th>Tache</th><th>Type</th></tr></thead>
                    <tbody>${tacheRows}</tbody>
                </table>
            </div>
        </div>`;
    }

    // ===== PROJETS =====
    function renderProjets() {
        const projets = DATA.projets;
        const enCours = projets.filter(p => p.statut === 'En cours').length;
        const enRetard = projets.filter(p => p.statut === 'En retard');
        const livres = projets.filter(p => p.statut === 'Livre').length;

        let rows = projets.map(p => `<tr onclick="openProjetPanel('${esc(p.nom).replace(/'/g, "\\'")}')" style="cursor:pointer"><td>${esc(p.nom)}</td><td>${esc(p.client)}</td><td>${esc(p.type)}</td><td>${esc(p.deadline)}</td><td><span class="badge ${badgeClass(p.statut)}">${esc(p.statut)}</span></td></tr>`).join('');

        document.getElementById('projets-content').innerHTML = `
        <div class="grid grid-3">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">En cours</div>
                <div class="card-value primary">${enCours}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">En retard</div>
                <div class="card-value accent">${enRetard.length}</div>
                ${enRetard.length ? '<div class="card-sub">' + esc(enRetard[0].nom) + '</div>' : ''}
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Livres recemment</div>
                <div class="card-value success">${livres}</div>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Rechercher un projet..." oninput="searchTable('projets-list', this.value)">
            <button class="filter-btn active" onclick="filterTable('projets-list', 'all', this)">Tous</button>
            <button class="filter-btn" onclick="filterTable('projets-list', 'En cours', this)">En cours</button>
            <button class="filter-btn" onclick="filterTable('projets-list', 'Livre', this)">Livres</button>
        </div>

        <div class="card table-card fade-in" style="animation-delay:0.25s">
            <div class="table-header">Liste des projets</div>
            <table>
                <thead><tr><th>Projet</th><th>Client</th><th>Type</th><th>Deadline</th><th>Statut</th></tr></thead>
                <tbody id="projets-list">${rows}</tbody>
            </table>
        </div>`;
    }

    // ===== CLIENTS =====
    function clientContactAgeDays(dc) {
        if (!dc) return Infinity;
        const d = new Date(dc);
        if (isNaN(d.getTime())) return Infinity;
        return Math.floor((Date.now() - d.getTime()) / (1000 * 60 * 60 * 24));
    }

    function renderClients() {
        const clients = DATA.clients;
        const total = clients.length;
        const actifs = clients.filter(c => c.statut === 'Actif').length;
        const projetsActifs = clients.filter(c => c.statut === 'Projet en cours').length;
        const sansContact3m = clients.filter(c => clientContactAgeDays(c.dernier_contact) > 90).length;
        const caTotal = clients.reduce((s, c) => s + (c.ca_total || 0), 0);
        const caTotalFmt = Math.round(caTotal).toLocaleString('fr-FR');

        let rows = clients.map(c => {
            const telHtml = c.telephone ? `<a href="tel:${esc(c.telephone)}" style="color:var(--primary)">${esc(c.telephone)}</a>` : '--';
            const emailHtml = c.email ? '<a href="mailto:' + esc(c.email) + '" style="color:var(--primary)">' + esc(c.email) + '</a>' : '--';
            const ageDays = clientContactAgeDays(c.dernier_contact);
            let contactHtml = '--';
            if (c.dernier_contact) {
                const color = ageDays > 90 ? '#e74c3c' : 'var(--success)';
                contactHtml = '<span style="color:' + color + ';font-weight:600">' + fmtDate(c.dernier_contact) + '</span>';
            }
            const caHtml = (c.ca_total || 0) > 0 ? '<span style="font-weight:600;color:var(--success)">' + Math.round(c.ca_total).toLocaleString('fr-FR') + '€</span>' : '--';
            return `<tr data-contact-age="${ageDays}" onclick="openClientPanel('${esc(c.nom).replace(/'/g, "\\'")}')" style="cursor:pointer"><td>${esc(c.nom)}</td><td>${caHtml}</td><td>${esc(c.site)}</td><td>${contactHtml}</td></tr>`;
        }).join('');

        document.getElementById('clients-content').innerHTML = `
        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Rechercher un client..." oninput="searchTable('clients-list', this.value)">
            <button class="filter-btn active" onclick="filterClientsByAge('all', this)">Tous (${total})</button>
            <button class="filter-btn" onclick="filterClientsByAge(90, this)">> 3 mois (${sansContact3m})</button>
        </div>

        <div class="card table-card fade-in" style="animation-delay:0.3s">
            <div class="table-header">Clients</div>
            <table>
                <thead><tr>
                    <th style="cursor:pointer" onclick="sortClientsTable(0,'alpha',this)">Client <span class="sort-icon"></span></th>
                    <th style="cursor:pointer" onclick="sortClientsTable(1,'num',this)">CA total <span class="sort-icon"></span></th>
                    <th style="cursor:pointer" onclick="sortClientsTable(2,'alpha',this)">Site <span class="sort-icon"></span></th>
                    <th style="cursor:pointer" onclick="sortClientsTable(3,'date',this)">Dernier Contact <span class="sort-icon"></span></th>
                </tr></thead>
                <tbody id="clients-list">${rows}</tbody>
            </table>
        </div>`;
    }

    // ===== PIPELINE =====
    function renderPipeline() {
        const pk = DATA.pipeline_kpis;
        const pipeline = DATA.pipeline;

        const etapeConfig = {
            offre_envoyee: { label: '📧 Offre envoyee', col: 'col-orange', badge: 'badge-orange' },
            en_discussion: { label: '💬 En discussion', col: 'col-blue', badge: 'badge-blue' },
            signe: { label: '✅ Signe', col: 'col-green', badge: 'badge-green' },
            perdu: { label: '❌ Perdu', col: 'col-gray', badge: 'badge-gray' }
        };

        let kanbanCols = '';
        for (const [key, cfg] of Object.entries(etapeConfig)) {
            const items = pipeline.filter(p => p.etape === key);
            const cards = items.map(p => `<div class="kanban-card"><div class="kanban-card-title">${esc(p.nom)}</div><div class="kanban-card-desc">${esc(p.desc)}</div><span class="badge ${cfg.badge}">${esc(p.montant)}</span></div>`).join('');
            kanbanCols += `<div class="kanban-column ${cfg.col}">
                <div class="kanban-column-header"><span>${cfg.label}</span><span class="count">${items.length}</span></div>
                <div class="kanban-column-body">${cards}</div>
            </div>`;
        }

        document.getElementById('pipeline-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Offres envoyees</div>
                <div class="card-value accent">${pk.offres_envoyees.count}</div>
                <div class="card-sub">${esc(pk.offres_envoyees.montant)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">En discussion</div>
                <div class="card-value primary">${pk.en_discussion.count}</div>
                <div class="card-sub">${esc(pk.en_discussion.detail)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Signes 2026</div>
                <div class="card-value success">${pk.signes.count}</div>
                <div class="card-sub">${esc(pk.signes.montant)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">Perdus</div>
                <div class="card-value primary">${pk.perdus.count}</div>
                <div class="card-sub">${esc(pk.perdus.detail)}</div>
            </div>
        </div>
        <div class="kanban-board">${kanbanCols}</div>`;
    }

    // ===== TÂCHES =====
    function renderTaches() {
        const taches = DATA.taches;
        const colonneConfig = {
            a_faire: { label: '📋 À faire', col: 'col-blue' },
            en_cours: { label: '🔄 En cours', col: 'col-orange' },
            termine: { label: '✅ Terminé', col: 'col-green' }
        };

        let kanbanCols = '';
        for (const [key, cfg] of Object.entries(colonneConfig)) {
            const items = taches.filter(t => t.colonne === key);
            const cards = items.map((t, i) => `<div class="kanban-card" style="animation-delay:${(0.05 + i * 0.05).toFixed(2)}s;cursor:pointer" onclick="openTachePanel('${esc(t.titre).replace(/'/g, "\\'")}')">
                <div class="kanban-card-title">${esc(t.titre)}</div>
                <div class="kanban-card-desc">${esc(t.desc)}</div>
                <span class="badge badge-${t.badge_color}">${esc(t.badge)}</span>
            </div>`).join('');
            kanbanCols += `<div class="kanban-column ${cfg.col}">
                <div class="kanban-column-header"><span>${cfg.label}</span><span class="count">${items.length}</span></div>
                <div class="kanban-column-body">${cards}</div>
            </div>`;
        }

        document.getElementById('taches-content').innerHTML = `<div class="kanban-board">${kanbanCols}</div>`;
    }

    // ===== PROSPECTION =====
    function renderProspection() {
        const p = DATA.prospection;
        const prospects = DATA.prospects;

        let rows = prospects.map(pr => {
            const tel = pr.telephone ? `<a href="tel:${esc(pr.telephone)}" style="color:var(--primary);text-decoration:none;">${esc(pr.telephone)}</a>` : '--';
            const email = pr.email ? `<a href="mailto:${esc(pr.email)}" style="color:var(--primary);text-decoration:none;">${esc(pr.email)}</a>` : '--';
            const secteur = pr.secteur ? esc(pr.secteur) : '--';
            return `<tr><td>${esc(pr.entreprise)}</td><td>${esc(pr.contact)}</td><td>${tel}</td><td>${email}</td><td>${secteur}</td><td><span class="badge badge-blue">${esc(pr.etape)}</span></td></tr>`;
        }).join('');

        let zoneRows = p.zones.map(z => `<tr><td>${esc(z.zone)}</td><td>${esc(z.prospects)}</td><td>${esc(z.secteur)}</td></tr>`).join('');

        const appPct = p.objectifs.appels.goal > 0 ? Math.round(p.objectifs.appels.current / p.objectifs.appels.goal * 100) : 0;
        const rdvPct = p.objectifs.rdv.goal > 0 ? Math.round(p.objectifs.rdv.current / p.objectifs.rdv.goal * 100) : 0;
        const devPct = p.objectifs.devis.goal > 0 ? Math.round(p.objectifs.devis.current / p.objectifs.devis.goal * 100) : 0;

        const nbRappel = prospects.filter(pr => pr.etape && pr.etape.includes('rappeler')).length;
        const nbContacter = prospects.filter(pr => pr.etape && pr.etape.includes('contacter')).length;
        const nbCallable = nbRappel + nbContacter;

        document.getElementById('prospection-content').innerHTML = `
        <div style="display:flex;align-items:center;gap:16px;margin-bottom:20px;flex-wrap:wrap;">
            <button class="start-session-btn" onclick="startSession()">📞 Lancer session (15 appels)</button>
            <span style="font-size:0.85rem;color:var(--text-light);">${nbCallable} prospects disponibles${nbRappel > 0 ? ' dont ' + nbRappel + ' a rappeler' : ''}</span>
        </div>
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Prospects a contacter</div>
                <div class="card-value accent">${p.prospects_a_contacter}</div>
                <div class="card-sub">dans le pipeline</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Appels ce mois</div>
                <div class="card-value primary">${p.appels_ce_mois}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Taux conversion</div>
                <div class="card-value primary">${esc(p.taux_conversion)}</div>
                <div class="card-sub">pas assez de donnees</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">RDV obtenus</div>
                <div class="card-value success">${p.rdv_obtenus}</div>
                <div class="card-sub">ce mois</div>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="card fade-in" style="animation-delay:0.3s">
                <div style="font-weight:600;margin-bottom:16px;">Objectifs du mois</div>
                <div style="margin-bottom:14px;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="font-size:0.88rem;">Appels</span><span style="color:var(--accent);font-weight:600;font-size:0.88rem;">${p.objectifs.appels.current} / ${p.objectifs.appels.goal}</span></div>
                    <div class="progress-bar"><div class="progress-fill accent" style="width:${appPct}%"></div></div>
                </div>
                <div style="margin-bottom:14px;">
                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="font-size:0.88rem;">RDV obtenus</span><span style="color:var(--primary);font-weight:600;font-size:0.88rem;">${p.objectifs.rdv.current} / ${p.objectifs.rdv.goal}</span></div>
                    <div class="progress-bar"><div class="progress-fill primary" style="width:${rdvPct}%"></div></div>
                </div>
                <div>
                    <div style="display:flex;justify-content:space-between;margin-bottom:4px;"><span style="font-size:0.88rem;">Devis envoyes</span><span style="color:var(--success);font-weight:600;font-size:0.88rem;">${p.objectifs.devis.current} / ${p.objectifs.devis.goal}</span></div>
                    <div class="progress-bar"><div class="progress-fill success" style="width:${devPct}%"></div></div>
                </div>
            </div>
            <div class="card table-card fade-in" style="animation-delay:0.35s">
                <div class="table-header">Prospects par zone</div>
                <table>
                    <thead><tr><th>Zone</th><th>Prospects</th><th>Secteur</th></tr></thead>
                    <tbody>${zoneRows}</tbody>
                </table>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Rechercher un prospect..." oninput="searchTable('prospect-list', this.value)">
            <button class="filter-btn active" onclick="filterTable('prospect-list', 'all', this)">Tous</button>
            <button class="filter-btn" onclick="filterTable('prospect-list', 'À contacter', this)">A contacter</button>
            <button class="filter-btn" onclick="filterTable('prospect-list', 'À rappeler', this)">A rappeler</button>
            <button class="filter-btn" onclick="filterTable('prospect-list', 'Pas intéressé', this)">Pas interesse</button>
        </div>
        <div class="card table-card fade-in" style="animation-delay:0.4s">
            <div class="table-header">Liste des prospects (${prospects.length})</div>
            <table>
                <thead><tr><th>Entreprise</th><th>Contact</th><th>Tel</th><th>Email</th><th>Secteur</th><th>Etape</th></tr></thead>
                <tbody id="prospect-list">${rows}</tbody>
            </table>
        </div>`;
    }

    // ===== BUSINESS =====
    function copyToClipboard(text, el) {
        navigator.clipboard.writeText(text).then(() => {
            const orig = el.innerHTML;
            el.innerHTML = '✓';
            el.style.color = 'var(--success)';
            setTimeout(() => { el.innerHTML = orig; el.style.color = ''; }, 1500);
        });
    }

    function copyIcon() {
        return '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
    }

    function bizInfoRow(label, value, copiable) {
        const copyBtn = copiable ? ' <button class="copy-btn" onclick="copyToClipboard(\'' + value.replace(/'/g, "\\'") + '\', this)">' + copyIcon() + '</button>' : '';
        return '<div class="biz-info-row"><span class="biz-info-key">' + label + '</span><span class="biz-info-left"><span class="biz-info-val">' + value + '</span>' + copyBtn + '</span></div>';
    }

    function renderBusiness() {
        document.getElementById('business-content').innerHTML = `
        <!-- Informations légales -->
        <div class="card fade-in" style="animation-delay:0.05s;padding:20px 24px;margin-bottom:16px;border-left:3px solid var(--accent);">
            <div style="font-size:1rem;color:var(--text);">Pixel Drop conçoit des solutions web et intègre l'intelligence artificielle dans les processus métier des PME.</div>
        </div>
        <div class="biz-header-row fade-in" style="animation-delay:0.1s;margin-bottom:12px;">
            <h3 class="biz-section-title" style="margin-bottom:0;">Informations Légales</h3>
            <a href="#" class="biz-open-link">📄 Ouvrir BUSINESS.md ↗</a>
        </div>
        <div class="grid grid-2 fade-in" style="animation-delay:0.1s">
            <div class="card" style="padding:20px;">
                <h4 style="font-size:0.8rem;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-light);margin-bottom:12px;">Identite</h4>
                ${bizInfoRow('Raison sociale', 'GOUDJIL AKLI', false)}
                ${bizInfoRow('Nom commercial', 'Pixel Drop', false)}
                ${bizInfoRow('Forme juridique', 'Entrepreneur Individuel', false)}
                ${bizInfoRow("Date d'immatriculation", '13/12/2021', false)}
                ${bizInfoRow('Code NAF/APE', '7410Z (Activités spécialisées de design)', true)}
                ${bizInfoRow('RCS', 'Paris', false)}
            </div>
            <div class="card" style="padding:20px;">
                <h4 style="font-size:0.8rem;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-light);margin-bottom:12px;">Coordonnees & numeros</h4>
                ${bizInfoRow('SIREN', '908154073', true)}
                ${bizInfoRow('SIRET', '90815407300013', true)}
                ${bizInfoRow('TVA Intracommunautaire', 'FR48908154073', true)}
                ${bizInfoRow("Adresse", "58 Rue de la Chaussée d'Antin, 75009 Paris", true)}
                ${bizInfoRow('Téléphone', '01 83 64 17 41', true)}
                ${bizInfoRow('Email', 'contact@pixel-drop.com', true)}
                <div class="biz-info-row"><span class="biz-info-key">Site web</span><span class="biz-info-left"><span class="biz-info-val"><a href="https://pixel-drop.com" target="_blank" style="color:var(--primary);text-decoration:none;">pixel-drop.com ↗</a></span></span></div>
            </div>
        </div>

        <!-- Services proposés -->
        <h2 class="biz-section-title fade-in" style="animation-delay:0.2s;margin-top:10px;">Services proposés</h2>
        <div class="grid grid-2">
            <div class="card fade-in" style="animation-delay:0.25s">
                <h3 class="biz-sub-title">🎨 Web & Design</h3>
                <div class="biz-service-grid">
                    <div class="biz-service-item">Création de sites internet (WordPress)</div>
                    <div class="biz-service-item">Web design</div>
                    <div class="biz-service-item">Design graphique</div>
                </div>
            </div>
            <div class="card fade-in" style="animation-delay:0.3s">
                <h3 class="biz-sub-title">⚡ Automatisations & IA</h3>
                <div class="biz-service-grid">
                    <div class="biz-service-item">Ventes & Devis</div>
                    <div class="biz-service-item">Prospection & Acquisition</div>
                    <div class="biz-service-item">CRM & Gestion commerciale</div>
                    <div class="biz-service-item">Clients & Onboarding</div>
                    <div class="biz-service-item">Facturation & Finance</div>
                    <div class="biz-service-item">Gestion de projet</div>
                    <div class="biz-service-item">Reporting & Analytics</div>
                    <div class="biz-service-item">Communication & Emails</div>
                    <div class="biz-service-item">Contenu & Marketing</div>
                    <div class="biz-service-item">Outils métier sur mesure</div>
                </div>
            </div>
        </div>

        <!-- Tarification -->
        <h2 class="biz-section-title fade-in" style="animation-delay:0.35s;margin-top:10px;">Tarification</h2>
        <div class="grid grid-4 biz-pricing-grid fade-in" style="animation-delay:0.4s">
            <div class="biz-pricing-card">
                <div class="offer-name">Automatisation</div>
                <div class="offer-price">5 000€</div>
                <div class="offer-detail">4 automatisations<br>Dashboard inclus<br>Formation 2h<br>30 jours de support</div>
                <div class="offer-delay">3-4 semaines</div>
            </div>
            <div class="biz-pricing-card">
                <div class="offer-name">Outil sur mesure</div>
                <div class="offer-price">8 000 - 15 000€</div>
                <div class="offer-detail">Outil spécifique<br>Formation 4h<br>45 jours de support</div>
                <div class="offer-delay">4-6 semaines</div>
            </div>
            <div class="biz-pricing-card">
                <div class="offer-name">Système complet</div>
                <div class="offer-price">15 000 - 25 000€</div>
                <div class="offer-detail">Automatisations illimitées + outils + IA<br>Formation complète<br>60 jours de support</div>
                <div class="offer-delay">6-8 semaines</div>
            </div>
            <div class="biz-pricing-card">
                <div class="offer-name">Maintenance</div>
                <div class="offer-price">400€<span style="font-size:0.9rem;font-weight:500;color:var(--text-light);">/mois</span></div>
                <div class="offer-detail">Monitoring 24/7<br>Corrections illimitées<br>2h évolutions/mois</div>
                <div class="offer-delay">Récurrent</div>
            </div>
        </div>
        <div class="card fade-in" style="animation-delay:0.45s;text-align:center;margin-top:-10px;">
            <span style="font-weight:600;color:var(--primary);font-size:1rem;">Panier moyen visé : 10 000€</span>
        </div>

        <!-- Objectifs, Cible, Outils, Équipe, Prospection -->
        <div class="grid grid-2" style="margin-top:10px;">
            <div class="card fade-in" style="animation-delay:0.5s">
                <h3 class="biz-section-title">🎯 Objectifs 2025</h3>
                <div style="margin-bottom:16px;">
                    <div class="card-label">Chiffre d'affaires</div>
                    <div class="card-value primary" style="font-size:2rem;">100 000€</div>
                </div>
            </div>
            <div class="card fade-in" style="animation-delay:0.55s">
                <h3 class="biz-section-title">🎯 Cible</h3>
                <ul class="biz-list">
                    <li><span class="biz-key">Cibles</span><span class="biz-val">PME, grands groupes</span></li>
                    <li><span class="biz-key">À éviter</span><span class="biz-val" style="color:#ef4444;">Particuliers, clients avec trop d'ego</span></li>
                </ul>
            </div>
        </div>

        <div class="biz-mini-cards fade-in" style="animation-delay:0.6s;margin-bottom:30px;">
            <div class="biz-mini-card">
                <h4>🛠 Outils</h4>
                <ul>
                    <li>Comptabilité : Pennylane</li>
                    <li>CRM / Gestion : Notion</li>
                    <li>Automatisations : n8n, Make</li>
                    <li>IA : Claude</li>
                </ul>
            </div>
            <div class="biz-mini-card">
                <h4>👤 Équipe</h4>
                <ul>
                    <li>Travaille seul</li>
                    <li>Projet : émuler des collaborateurs à terme</li>
                </ul>
            </div>
            <div class="biz-mini-card">
                <h4>📞 Prospection</h4>
                <ul>
                    <li>LinkedIn Sales Navigator</li>
                    <li>Cold calling</li>
                    <li>Bouche à oreille</li>
                    <li>BARK.com</li>
                </ul>
            </div>
        </div>`;
    }

    // ===== FINANCES =====
    function renderFinances() {
        const f = DATA.finances;
        const maxCA = Math.max(...f.ca_mensuel_chart.map(m => m.montant || 0), 1);
        let bars = f.ca_mensuel_chart.map(m => {
            const h = m.montant !== null && m.montant > 0 ? Math.round(m.montant / maxCA * 100) + '%' : '2px';
            const bg = m.montant !== null ? 'var(--primary)' : 'var(--border)';
            return `<div class="bar-col"><span class="bar-amount">${esc(m.label)}</span><div class="bar-fill" style="height:${h};background:${bg}"></div><span class="bar-label">${esc(m.mois)}</span></div>`;
        }).join('');

        // Objectif annuel
        const caAnnuelNum = parseInt(f.total_2026.replace(/[^0-9]/g, '')) || 0;
        const objAnnuel = DATA.objectifs.ca_annuel;
        const objAnnuelPct = objAnnuel > 0 ? Math.min(100, Math.round(caAnnuelNum / objAnnuel * 100)) : 0;
        const objAnnuelColor = objAnnuelPct >= 80 ? 'var(--success)' : objAnnuelPct >= 50 ? 'var(--warning)' : '#ef4444';
        const caAnnuelFmt = caAnnuelNum.toLocaleString('fr-FR');
        const objAnnuelFmt = objAnnuel.toLocaleString('fr-FR');

        document.getElementById('finances-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Objectif annuel 2026</div>
                <div style="display:flex;justify-content:space-between;align-items:baseline;margin:8px 0 4px;">
                    <span class="card-value" style="font-size:1.3rem;">${caAnnuelFmt}€</span>
                    <span style="color:var(--text-light);font-size:0.85rem;">/ ${objAnnuelFmt}€</span>
                </div>
                <div style="background:var(--border);border-radius:8px;height:8px;overflow:hidden;">
                    <div style="background:${objAnnuelColor};height:100%;width:${objAnnuelPct}%;border-radius:8px;transition:width 0.5s ease;"></div>
                </div>
                <div style="text-align:right;font-size:0.78rem;color:var(--text-light);margin-top:4px;">${objAnnuelPct}%</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">CA Janvier 2026</div>
                <div class="card-value primary">${esc(f.ca_janvier.montant)}</div>
                <div class="card-sub">${esc(f.ca_janvier.detail)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">CA Fevrier 2026</div>
                <div class="card-value accent">${esc(f.ca_fevrier.montant)}</div>
                <div class="card-sub">${esc(f.ca_fevrier.detail)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">Devis en attente</div>
                <div class="card-value accent">${esc(f.devis_attente.montant)}</div>
                <div class="card-sub">${esc(f.devis_attente.detail)}</div>
            </div>
        </div>

        <div class="grid grid-2">
            <div class="card fade-in" style="animation-delay:0.3s">
                <div style="display:flex;justify-content:space-between;align-items:center;padding:0 0 16px;">
                    <span style="font-weight:600;">CA mensuel</span>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button onclick="switchChartYear(-1)" style="background:none;border:none;cursor:pointer;color:var(--text-light);font-size:1rem;">&lsaquo;</button>
                        <span id="chart-year-label">2026</span>
                        <button onclick="switchChartYear(1)" style="background:none;border:none;cursor:pointer;color:var(--text-light);font-size:1rem;">&rsaquo;</button>
                    </div>
                </div>
                <div class="bar-chart">${bars}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.35s">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                    <span style="font-weight:600;">Charges du mois</span>
                    <div style="display:flex;align-items:center;gap:8px;">
                        <button onclick="switchChargesMonth(-1)" style="background:none;border:none;cursor:pointer;color:var(--text-light);font-size:1rem;">&lsaquo;</button>
                        <span id="charges-month-label">Février 2026</span>
                        <button onclick="switchChargesMonth(1)" style="background:none;border:none;cursor:pointer;color:var(--text-light);font-size:1rem;">&rsaquo;</button>
                    </div>
                </div>
                <div id="charges-content">
                    <!-- Sera rempli par JS -->
                </div>
            </div>
        </div>`;
        renderChargesMonth();
    }

    // ===== CHARGES MENSUELLES =====
    let chargesMonthIdx = new Date().getMonth();
    function switchChargesMonth(dir) {
        chargesMonthIdx = Math.max(0, Math.min(11, chargesMonthIdx + dir));
        renderChargesMonth();
    }
    function renderChargesMonth() {
        const moisNoms = ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];
        const chart = DATA.finances.ca_mensuel_chart;
        const m = chart[chargesMonthIdx];
        const ca = (m && m.montant !== null) ? m.montant : 0;
        const urssaf = Math.round(ca * 0.231);
        const ir = Math.round(ca * 0.022);
        const cfe = 42; // 500€/an
        const net = ca - urssaf - ir - cfe;
        const fmt = (n) => n.toLocaleString('fr-FR') + '€';

        const labelEl = document.getElementById('charges-month-label');
        const contentEl = document.getElementById('charges-content');
        if (labelEl) labelEl.textContent = moisNoms[chargesMonthIdx] + ' 2026';
        if (contentEl) contentEl.innerHTML = `
            <div class="sim-row"><span class="sim-label">CA du mois</span><span class="sim-value">${fmt(ca)}</span></div>
            <div class="sim-row"><span class="sim-label">URSSAF (23.1%)</span><span class="sim-value negative">-${fmt(urssaf)}</span></div>
            <div class="sim-row"><span class="sim-label">IR liberatoire (2.2%)</span><span class="sim-value negative">-${fmt(ir)}</span></div>
            <div class="sim-row"><span class="sim-label">CFE (estimee)</span><span class="sim-value negative">-${fmt(cfe)}</span></div>
            <div class="sim-row" style="border-top:2px solid var(--text);padding-top:12px;margin-top:4px;">
                <span class="sim-label" style="font-weight:700;color:var(--text);">Net du mois</span>
                <span class="sim-value ${net >= 0 ? 'positive' : 'negative'}" style="font-size:1.1rem;">${fmt(net)}</span>
            </div>
        `;
    }

    // ===== CHART YEAR NAVIGATION =====
    let chartYear = 2026;
    function switchChartYear(dir) {
        chartYear += dir;
        const labelEl = document.getElementById('chart-year-label');
        if (labelEl) labelEl.textContent = chartYear;
        // Pour l'instant seule 2026 a des données, on re-render quand même
    }

    // ===== DEVIS & FACTURES =====
    function renderDevis() {
        const dk = DATA.devis_kpis;
        const devis = DATA.devis;
        const factures = DATA.factures;

        let devisRows = devis.map(d => `<tr><td>${esc(d.date)}</td><td>${esc(d.client)}</td><td>${esc(d.objet)}</td><td>${esc(d.montant)}</td><td><span class="badge ${badgeClass(d.statut)}">${esc(d.statut)}</span></td><td><a href="${esc(d.pdf)}" target="_blank" style="color:var(--primary)">↗</a></td></tr>`).join('');

        let factRows = factures.map(f => `<tr><td>${fmtDate(f.date)}</td><td>${esc(f.client)}</td><td>${esc(f.objet)}</td><td>${esc(f.montant)}</td><td><span class="badge ${badgeClass(f.statut)}">${esc(f.statut)}</span></td><td><a href="${esc(f.pdf)}" target="_blank" style="color:var(--primary)">↗</a></td></tr>`).join('');

        // Relances
        const relances = getRelances();
        let relancesHtml = '';
        if (relances.length === 0) {
            relancesHtml = '<div style="padding:16px 24px;color:var(--success);font-weight:500;">✓ Aucune relance en attente</div>';
        } else {
            const relanceRows = relances.map(r => {
                const isUrgent = r.jours > 14;
                const color = isUrgent ? '#ef4444' : '#f59e0b';
                const label = isUrgent ? r.jours + ' jours - RELANCE URGENTE' : r.jours + ' jours sans reponse';
                return `<tr><td>${esc(r.objet)}</td><td>${esc(r.client)}</td><td>${esc(r.montant)}</td><td><span style="color:${color};font-weight:600;font-size:0.82rem;">${label}</span></td></tr>`;
            }).join('');
            relancesHtml = `<table><thead><tr><th>Devis</th><th>Client</th><th>Montant</th><th>Statut</th></tr></thead><tbody>${relanceRows}</tbody></table>`;
        }

        document.getElementById('devis-content').innerHTML = `
        <div class="card fade-in" style="border-left:3px solid #ef4444;margin-bottom:20px;">
            <div class="table-header" style="padding:12px 0;">Relances necessaires</div>
            ${relancesHtml}
        </div>

        <div class="grid grid-3">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Devis en attente</div>
                <div class="card-value accent">${dk.en_attente.count}</div>
                <div class="card-sub">${esc(dk.en_attente.montant)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Devis acceptes</div>
                <div class="card-value success">${dk.acceptes.count}</div>
                <div class="card-sub">${esc(dk.acceptes.montant)}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Factures payees</div>
                <div class="card-value primary">${dk.factures_payees.count}</div>
                <div class="card-sub">${esc(dk.factures_payees.montant)}</div>
            </div>
        </div>

        <div class="sub-tabs">
            <button class="sub-tab active" onclick="switchSubTab('devis', this)">Devis</button>
            <button class="sub-tab" onclick="switchSubTab('factures', this)">Factures</button>
        </div>

        <div class="sub-tab-content active" id="subtab-devis">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Rechercher un devis..." oninput="searchTable('devis-list', this.value)">
            </div>
            <div class="card table-card fade-in" style="animation-delay:0.25s">
                <table>
                    <thead><tr><th>Date</th><th>Client</th><th>Objet</th><th>Montant</th><th>Statut</th><th>PDF</th></tr></thead>
                    <tbody id="devis-list">${devisRows}</tbody>
                </table>
            </div>
        </div>

        <div class="sub-tab-content" id="subtab-factures">
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Rechercher une facture..." oninput="searchTable('factures-list', this.value)">
            </div>
            <div class="card table-card fade-in">
                <table>
                    <thead><tr><th>Date</th><th>Client</th><th>Objet</th><th>Montant</th><th>Statut</th><th>PDF</th></tr></thead>
                    <tbody id="factures-list">${factRows}</tbody>
                </table>
            </div>
        </div>`;
    }

    // ===== ABONNEMENTS =====
    function renderAbonnements() {
        const abos = DATA.abonnements;
        const actifs = abos.filter(a => !a.placeholder).length;

        let rows = abos.map(a => {
            const style = a.placeholder ? 'color:var(--text-light);font-style:italic' : '';
            const noteStyle = a.placeholder ? 'color:var(--text-light)' : '';
            return `<tr><td style="${style}">${esc(a.outil)}</td><td>${esc(a.cout)}</td><td><span class="badge badge-${a.badge_color}">${esc(a.categorie)}</span></td><td style="${noteStyle}">${esc(a.notes)}</td></tr>`;
        }).join('');

        document.getElementById('abonnements-content').innerHTML = `
        <div class="grid grid-3">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Total mensuel estime</div>
                <div class="card-value primary">~50€</div>
                <div class="card-sub">a completer</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Outils actifs</div>
                <div class="card-value accent">${actifs}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Prochain renouvellement</div>
                <div class="card-value primary">--</div>
            </div>
        </div>

        <div class="card table-card fade-in" style="animation-delay:0.25s">
            <div class="table-header">Liste des abonnements</div>
            <table>
                <thead><tr><th>Outil</th><th>Cout/mois</th><th>Categorie</th><th>Notes</th></tr></thead>
                <tbody>${rows}</tbody>
            </table>
        </div>
        <p style="color:var(--text-light);font-size:0.85rem;margin-top:16px;text-align:center;">Complete cette liste ! Dis a Claudia tes abonnements manquants.</p>`;
    }

    // ===== MARKETING =====
    function renderMarketing() {
        const m = DATA.marketing;
        const liPct = Math.round(m.linkedin.current / m.linkedin.goal * 100);
        const igPct = Math.round(m.instagram.current / m.instagram.goal * 100);
        const nlPct = Math.min(100, Math.round(m.newsletter_stats.contacts / m.newsletter.goal * 100));
        const trPct = Math.round(m.trafic.current / m.trafic.goal * 100 * 10) / 10;

        let channelCards = m.channels_priority.map((c, i) => `
            <div class="card fade-in" style="animation-delay:${(0.5 + i * 0.05).toFixed(2)}s;text-align:center;">
                <div class="card-label">#${c.rank} ${c.rank <= 4 ? 'Priorite' : 'Bonus'}</div>
                <div style="font-size:1.1rem;font-weight:700;">${esc(c.name)}</div>
                <div style="color:var(--${c.status_color});font-size:0.85rem;margin-top:6px;">${esc(c.status)}</div>
            </div>`).join('');

        document.getElementById('marketing-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">LinkedIn</div>
                <div class="card-value accent">${m.linkedin.current}</div>
                <div class="card-sub">Objectif : ${m.linkedin.goal} followers</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Instagram</div>
                <div class="card-value accent">${m.instagram.current}</div>
                <div class="card-sub">Objectif : ${m.instagram.goal} followers</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Newsletter</div>
                <div class="card-value accent">${m.newsletter_stats.contacts}</div>
                <div class="card-sub">Objectif : ${m.newsletter.goal} abonnes</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">Trafic site (30j)</div>
                <div class="card-value accent">${m.trafic.current}</div>
                <div class="card-sub">Objectif : ${m.trafic.goal} sessions</div>
            </div>
        </div>

        <h2 style="font-size:1.2rem; margin-bottom:18px;">Progression vers les objectifs 2026</h2>
        <div class="grid grid-2">
            <div class="card fade-in" style="animation-delay:0.3s">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                    <span style="font-weight:600;font-size:0.9rem;">LinkedIn Followers</span>
                    <span style="color:var(--accent);font-weight:600;font-size:0.88rem;">${m.linkedin.current} / ${m.linkedin.goal} (${liPct}%)</span>
                </div>
                <div class="progress-bar"><div class="progress-fill accent" style="width:${liPct}%"></div></div>
            </div>
            <div class="card fade-in" style="animation-delay:0.35s">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                    <span style="font-weight:600;font-size:0.9rem;">Instagram Followers</span>
                    <span style="color:var(--accent);font-weight:600;font-size:0.88rem;">${m.instagram.current} / ${m.instagram.goal} (${igPct}%)</span>
                </div>
                <div class="progress-bar"><div class="progress-fill accent" style="width:${igPct}%"></div></div>
            </div>
            <div class="card fade-in" style="animation-delay:0.4s">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                    <span style="font-weight:600;font-size:0.9rem;">Newsletter Abonnes</span>
                    <span style="color:var(--accent);font-weight:600;font-size:0.88rem;">${m.newsletter_stats.contacts} / ${m.newsletter.goal} (${nlPct}%)</span>
                </div>
                <div class="progress-bar"><div class="progress-fill accent" style="width:${nlPct}%"></div></div>
            </div>
            <div class="card fade-in" style="animation-delay:0.45s">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                    <span style="font-weight:600;font-size:0.9rem;">Trafic Mensuel</span>
                    <span style="color:var(--accent);font-weight:600;font-size:0.88rem;">${m.trafic.current} / ${m.trafic.goal} (${trPct}%)</span>
                </div>
                <div class="progress-bar"><div class="progress-fill accent" style="width:${trPct}%"></div></div>
            </div>
        </div>

        <h2 style="font-size:1.2rem; margin: 25px 0 18px;">Canaux par priorite</h2>
        <div class="grid grid-4 channels-grid-5" style="grid-template-columns: repeat(5, 1fr);">${channelCards}</div>`;
    }

    // ===== NEWSLETTER =====
    function renderNewsletter() {
        const ns = DATA.marketing.newsletter_stats;

        document.getElementById('newsletter-content').innerHTML = `
        <div class="grid grid-3">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Contacts</div>
                <div class="card-value primary">${ns.contacts}</div>
                <div class="card-sub">abonnes actifs</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Taux ouverture</div>
                <div class="card-value accent">${esc(ns.open_rate)}</div>
                <div class="card-sub">derniere campagne</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Campagnes envoyees</div>
                <div class="card-value primary">${ns.campaigns_sent}</div>
                <div class="card-sub">total</div>
            </div>
        </div>

        <div class="card table-card fade-in" style="animation-delay:0.25s">
            <div class="table-header">Dernieres campagnes</div>
            <table>
                <thead><tr><th>Campagne</th><th>Date</th><th>Envoyes</th><th>Ouvertures</th><th>Clics</th></tr></thead>
                <tbody id="nl-list">
                    <tr><td colspan="5" style="text-align:center;color:var(--text-light)">Chargement...</td></tr>
                </tbody>
            </table>
        </div>`;
    }

    // ===== SEO =====
    function renderSEO() {
        const s = DATA.seo;
        let rows = s.queries.map(q => `<tr><td>${esc(q.query)}</td><td>${q.clicks}</td><td>${q.impressions}</td><td>${q.position}</td></tr>`).join('');

        document.getElementById('seo-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Clics (30j)</div>
                <div class="card-value primary">${s.clicks}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Impressions (30j)</div>
                <div class="card-value accent">${s.impressions}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Position moyenne</div>
                <div class="card-value primary">${s.position}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">CTR moyen</div>
                <div class="card-value success">${esc(s.ctr)}</div>
            </div>
        </div>

        <div class="card table-card fade-in" style="animation-delay:0.3s">
            <div class="table-header">Top requetes</div>
            <table>
                <thead><tr><th>Requete</th><th>Clics</th><th>Impressions</th><th>Position</th></tr></thead>
                <tbody>${rows}</tbody>
            </table>
        </div>`;
    }

    // ===== SITES WORDPRESS =====
    function renderSites() {
        const sites = DATA.sites;
        const active = sites.filter(s => s.maintenance === 'Active').length;
        const inactive = sites.filter(s => s.maintenance === 'Inactive').length;
        const html = sites.filter(s => s.type === 'html').length;
        const total = sites.length;

        let rows = sites.map(s => {
            const dc = dateClass(s.fin_contrat);
            const ms = majStyle(s.maj_dispo);
            const maintBadge = s.maintenance === 'Active' ? 'badge-green' : (s.maintenance === 'Inactive' ? 'badge-gray' : 'badge-blue');
            const wpLink = s.type === 'wordpress' ? `<a href="${esc(s.full_url)}/wp-admin" target="_blank" class="wp-admin-link" title="wp-admin">&#9881;</a>` : '';
            const apiLabel = s.type === 'html' ? '--' : (s.api ? '<span class="badge badge-green">OUI</span>' : '<span class="badge badge-gray">NON</span>');
            const majLabel = s.type === 'html' ? '--' : (s.maj_dispo || '?');

            const dmDate = s.derniere_maintenance;
            const dmClass = !dmDate ? 'color:var(--danger)' : (() => { const d = new Date(dmDate); const diff = (new Date() - d) / 86400000; return diff > 90 ? 'color:var(--danger)' : diff > 30 ? 'color:var(--warning)' : 'color:var(--success)'; })();
            const dmLabel = dmDate ? dmDate.split('-').reverse().join('/') : 'Jamais';
            const dmSort = dmDate || '0000-00-00';

            return `<tr><td>${wpLink}</td><td><a href="${esc(s.full_url)}" target="_blank" style="color:var(--primary)">${esc(s.url)} ↗</a></td><td><span class="badge ${maintBadge}">${esc(s.maintenance)}</span></td><td class="${dc}">${esc(s.fin_contrat)}</td><td style="${dmClass}" data-sort="${dmSort}">${esc(dmLabel)}</td><td style="${ms}">${esc(String(majLabel))}</td><td>${apiLabel}</td></tr>`;
        }).join('');

        document.getElementById('sites-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">Maintenance active</div>
                <div class="card-value primary">${active}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Maintenance inactive</div>
                <div class="card-value accent">${inactive}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Sites non-WP</div>
                <div class="card-value primary">${html}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">Total</div>
                <div class="card-value success">${total}</div>
            </div>
        </div>

        <div class="search-bar">
            <input type="text" class="search-input" placeholder="Rechercher un site..." oninput="searchTable('sites-list', this.value)">
            <button class="filter-btn active" onclick="filterTable('sites-list', 'all', this)">Tous</button>
            <button class="filter-btn" onclick="filterTable('sites-list', 'Active', this)">Active</button>
            <button class="filter-btn" onclick="filterTable('sites-list', 'Inactive', this)">Inactive</button>
            <button class="filter-btn" onclick="filterTable('sites-list', 'HTML', this)">Non-WP</button>
        </div>

        <div class="card table-card fade-in" style="animation-delay:0.25s">
            <div class="table-header">Tous les sites</div>
            <table>
                <thead><tr><th></th><th>Site</th><th>Maintenance</th><th>Fin contrat</th><th style="cursor:pointer;user-select:none" onclick="sortSitesBy(4)">Dern. maint. ⇅</th><th>MAJ dispo</th><th>API</th></tr></thead>
                <tbody id="sites-list">${rows}</tbody>
            </table>
        </div>`;
    }

    function renderStatus() {
        const services = DATA.system_status || [];
        const updated = DATA.system_status_updated || '';
        const categories = [...new Set(services.map(s => s.categorie))];
        const allOk = services.every(s => s.statut === 'ok');
        const issues = services.filter(s => s.statut !== 'ok');
        const updatedDate = updated ? new Date(updated).toLocaleString('fr-FR') : '--';

        let html = `
        <div style="text-align:center;margin:20px 0 30px">
            <div style="font-size:1.1rem;margin-bottom:8px">
                <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:${allOk ? 'var(--success)' : 'var(--danger)'};margin-right:6px"></span>
                ${allOk ? 'Tous les systèmes sont opérationnels' : issues.length + ' service(s) en anomalie'}
            </div>
            <div style="color:var(--text-light);font-size:0.85rem">Dernière vérification : ${updatedDate}</div>
        </div>`;

        categories.forEach(cat => {
            const catServices = services.filter(s => s.categorie === cat);
            html += `<div class="card fade-in" style="margin-bottom:16px;padding:20px">
                <div style="font-weight:600;font-size:1rem;margin-bottom:12px;color:var(--text-light)">${cat}</div>`;
            catServices.forEach(s => {
                const color = s.statut === 'ok' ? 'var(--success)' : s.statut === 'issue' ? '#f0ad4e' : 'var(--danger)';
                const label = s.statut === 'ok' ? 'Opérationnel' : s.statut === 'issue' ? 'Problème' : 'Indisponible';
                html += `<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border)">
                    <span>${s.nom}</span>
                    <span style="display:flex;align-items:center;gap:6px;font-size:0.85rem;color:${color}">
                        ${label} <span style="display:inline-block;width:10px;height:10px;border-radius:50%;background:${color}"></span>
                    </span>
                </div>`;
            });
            html += `</div>`;
        });

        document.getElementById('status-content').innerHTML = html;
    }

    let sitesSortAsc = true;
    function sortSitesBy(colIdx) {
        const tbody = document.getElementById('sites-list');
        if (!tbody) return;
        const rows = Array.from(tbody.querySelectorAll('tr'));
        rows.sort((a, b) => {
            const aVal = a.cells[colIdx]?.getAttribute('data-sort') || a.cells[colIdx]?.textContent || '';
            const bVal = b.cells[colIdx]?.getAttribute('data-sort') || b.cells[colIdx]?.textContent || '';
            return sitesSortAsc ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
        });
        sitesSortAsc = !sitesSortAsc;
        rows.forEach(r => tbody.appendChild(r));
    }

    // ===== LINKEDIN =====
    function renderLinkedin() {
        const posts = DATA.linkedin_posts || [];
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();

        const aPublier = posts.filter(p => p.statut === 'redaction' || p.statut === 'a_publier').length;
        const planifies = posts.filter(p => new Date(p.date) > now && p.statut !== 'publie').length;
        const publiesMois = posts.filter(p => {
            const d = new Date(p.date);
            return p.statut === 'publie' && d.getMonth() === currentMonth && d.getFullYear() === currentYear;
        }).length;

        const statutToCol = { idee: 'idee', redaction: 'redaction', a_publier: 'pret', pret: 'pret', publie: 'publie' };
        const colonneConfig = {
            idee: { label: '💡 Idee', col: 'col-gray' },
            redaction: { label: '✏️ Redaction', col: 'col-orange' },
            pret: { label: '🚀 Pret a publier', col: 'col-blue' },
            publie: { label: '✅ Publie', col: 'col-green' }
        };

        function typeBadge(type) {
            if (type === 'article' || type === 'post') return 'badge-blue';
            if (type === 'carousel') return 'badge-orange';
            return 'badge-gray';
        }

        let kanbanCols = '';
        for (const [key, cfg] of Object.entries(colonneConfig)) {
            const items = posts.filter(p => (statutToCol[p.statut] || p.statut) === key);
            const cards = items.map((p, i) => `<div class="kanban-card" style="animation-delay:${(0.05 + i * 0.05).toFixed(2)}s">
                <div class="kanban-card-title">${esc(p.titre)}</div>
                <div class="kanban-card-desc">${fmtDate(p.date)}</div>
                <span class="badge ${typeBadge(p.type)}">${esc(p.type)}</span>
            </div>`).join('');
            kanbanCols += `<div class="kanban-column ${cfg.col}">
                <div class="kanban-column-header"><span>${cfg.label}</span><span class="count">${items.length}</span></div>
                <div class="kanban-column-body">${cards}</div>
            </div>`;
        }

        document.getElementById('linkedin-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">A publier</div>
                <div class="card-value accent">${aPublier}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Planifies</div>
                <div class="card-value primary">${planifies}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Publies ce mois</div>
                <div class="card-value success">${publiesMois}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">Engagement moyen</div>
                <div class="card-value primary">--</div>
            </div>
        </div>
        <div class="kanban-board">${kanbanCols}</div>`;
    }

    // ===== INSTAGRAM =====
    function renderInstagram() {
        const posts = DATA.instagram_posts || [];
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();

        const aPublier = posts.filter(p => p.statut === 'creation' || p.statut === 'a_publier').length;
        const planifies = posts.filter(p => new Date(p.date) > now && p.statut !== 'publie').length;
        const publiesMois = posts.filter(p => {
            const d = new Date(p.date);
            return p.statut === 'publie' && d.getMonth() === currentMonth && d.getFullYear() === currentYear;
        }).length;

        const statutToCol = { idee: 'idee', creation: 'creation', a_publier: 'pret', pret: 'pret', publie: 'publie' };
        const colonneConfig = {
            idee: { label: '💡 Idee', col: 'col-gray' },
            creation: { label: '🎨 Creation', col: 'col-orange' },
            pret: { label: '🚀 Pret a publier', col: 'col-blue' },
            publie: { label: '✅ Publie', col: 'col-green' }
        };

        function typeBadge(type) {
            if (type === 'article' || type === 'post') return 'badge-blue';
            if (type === 'carousel') return 'badge-orange';
            if (type === 'reel') return 'badge-purple';
            if (type === 'story') return 'badge-gray';
            return 'badge-gray';
        }

        let kanbanCols = '';
        for (const [key, cfg] of Object.entries(colonneConfig)) {
            const items = posts.filter(p => (statutToCol[p.statut] || p.statut) === key);
            const cards = items.map((p, i) => `<div class="kanban-card" style="animation-delay:${(0.05 + i * 0.05).toFixed(2)}s">
                <div class="kanban-card-title">${esc(p.titre)}</div>
                <div class="kanban-card-desc">${fmtDate(p.date)}</div>
                <span class="badge ${typeBadge(p.type)}">${esc(p.type)}</span>
            </div>`).join('');
            kanbanCols += `<div class="kanban-column ${cfg.col}">
                <div class="kanban-column-header"><span>${cfg.label}</span><span class="count">${items.length}</span></div>
                <div class="kanban-column-body">${cards}</div>
            </div>`;
        }

        document.getElementById('instagram-content').innerHTML = `
        <div class="grid grid-4">
            <div class="card fade-in" style="animation-delay:0.1s">
                <div class="card-label">A publier</div>
                <div class="card-value accent">${aPublier}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.15s">
                <div class="card-label">Planifies</div>
                <div class="card-value primary">${planifies}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.2s">
                <div class="card-label">Publies ce mois</div>
                <div class="card-value success">${publiesMois}</div>
            </div>
            <div class="card fade-in" style="animation-delay:0.25s">
                <div class="card-label">Engagement moyen</div>
                <div class="card-value primary">--</div>
            </div>
        </div>
        <div class="kanban-board">${kanbanCols}</div>`;
    }

    // ===== GLOBAL FUNCTIONS =====

    // Toggle sidebar
    document.getElementById('toggleBtn').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('collapsed');
    });

    // Switch tabs
    function switchTab(tabId, el) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById('tab-' + tabId).classList.add('active');
        el.classList.add('active');

        // Re-trigger animations
        document.querySelectorAll('#tab-' + tabId + ' .fade-in').forEach(el => {
            el.style.animation = 'none';
            el.offsetHeight;
            el.style.animation = '';
        });

        // Close mobile menu on nav click
        if (window.innerWidth <= 768) {
            closeMobileMenu();
        }
    }

    // Toggle sidebar sections (chevron)
    function toggleSection(sectionEl) {
        const chevron = sectionEl.querySelector('.chevron');
        const items = sectionEl.nextElementSibling;
        if (!items || !items.classList.contains('nav-section-items')) return;

        chevron.classList.toggle('collapsed');
        items.classList.toggle('collapsed');
    }

    // Initialize section heights for smooth collapse
    function initSections() {
        document.querySelectorAll('.nav-section-items').forEach(el => {
            el.style.maxHeight = el.scrollHeight + 'px';
        });
    }
    // Run after DOM ready
    setTimeout(initSections, 50);

    // Mobile bottom sheet
    function toggleMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        sidebar.classList.toggle('mobile-open');
        overlay.classList.toggle('visible');
    }

    function closeMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        sidebar.classList.remove('mobile-open');
        overlay.classList.remove('visible');
    }

    // Swipe down to close bottom sheet
    (function() {
        const sidebar = document.getElementById('sidebar');
        if (!sidebar) return;
        let startY = 0, currentY = 0, dragging = false;

        sidebar.addEventListener('touchstart', function(e) {
            const nav = sidebar.querySelector('.sidebar-nav');
            // Only allow drag from top of sheet or when nav is scrolled to top
            if (nav && nav.scrollTop > 0) return;
            startY = e.touches[0].clientY;
            dragging = true;
            sidebar.style.transition = 'none';
        }, { passive: true });

        sidebar.addEventListener('touchmove', function(e) {
            if (!dragging) return;
            currentY = e.touches[0].clientY;
            const diff = currentY - startY;
            if (diff > 0) {
                sidebar.style.transform = 'translateY(' + diff + 'px)';
            }
        }, { passive: true });

        sidebar.addEventListener('touchend', function() {
            if (!dragging) return;
            dragging = false;
            sidebar.style.transition = '';
            const diff = currentY - startY;
            if (diff > 80) {
                closeMobileMenu();
            }
            sidebar.style.transform = '';
            if (sidebar.classList.contains('mobile-open')) {
                sidebar.style.transform = 'translateY(0)';
            }
            startY = 0; currentY = 0;
        }, { passive: true });
    })();

    // Date
    const dateStr = new Date().toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById('dash-date').textContent = dateStr.charAt(0).toUpperCase() + dateStr.slice(1);

    // Month navigation for CA mensuel
    let caMonthIdx = new Date().getMonth();
    const caMoisNoms = ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];
    function switchMonth(dir) {
        caMonthIdx = Math.max(0, Math.min(11, caMonthIdx + dir));
        const chart = DATA.finances.ca_mensuel_chart;
        const m = chart[caMonthIdx];
        const val = (m && m.montant !== null) ? m.montant.toLocaleString('fr-FR') + '€' : '--';
        const label = caMoisNoms[caMonthIdx] + ' 2026';
        const valEl = document.getElementById('ca-month-val');
        const labelEl = document.getElementById('ca-month-label');
        if (valEl) valEl.textContent = val;
        if (labelEl) labelEl.textContent = label;
    }

    // Clock
    function updateClock() {
        document.getElementById('clock').textContent = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
    }
    updateClock();
    setInterval(updateClock, 30000);

    // Calendar week view
    function buildWeek() {
        const today = new Date();
        const day = today.getDay();
        const monday = new Date(today);
        monday.setDate(today.getDate() - (day === 0 ? 6 : day - 1));
        const days = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
        const container = document.getElementById('week-view');
        if (!container) return;
        container.innerHTML = '';
        for (let i = 0; i < 7; i++) {
            const d = new Date(monday);
            d.setDate(monday.getDate() + i);
            const isToday = d.toDateString() === today.toDateString();
            container.innerHTML += '<div class="week-day' + (isToday ? ' today' : '') + '"><div class="week-day-label">' + days[i] + '</div><div class="week-day-num">' + d.getDate() + '</div>' + (isToday ? '<div style="font-size:0.78rem;color:var(--primary);font-weight:600;">Aujourd\'hui</div>' : '') + '</div>';
        }
        const subtitle = document.getElementById('cal-subtitle');
        if (subtitle) {
            const mois = today.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
            subtitle.textContent = 'Semaine du ' + monday.getDate() + ' au ' + new Date(monday.getTime() + 6*86400000).getDate() + ' ' + mois;
        }
    }
    buildWeek();

    // Search tables
    function searchTable(tbodyId, query) {
        const tbody = document.getElementById(tbodyId);
        if (!tbody) return;
        const rows = tbody.querySelectorAll('tr');
        const q = query.toLowerCase().trim();
        rows.forEach(row => {
            row.style.display = (!q || row.textContent.toLowerCase().includes(q)) ? '' : 'none';
        });
    }

    // Sub-tabs (Devis/Factures)
    function switchSubTab(tabId, btn) {
        const parent = btn.closest('.tab');
        parent.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
        parent.querySelectorAll('.sub-tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('subtab-' + tabId).classList.add('active');
    }

    // Filter tables
    function filterTable(tbodyId, filter, btn) {
        const tbody = document.getElementById(tbodyId);
        if (!tbody) return;
        const rows = tbody.querySelectorAll('tr');

        // Update active button
        btn.parentElement.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        rows.forEach(row => {
            if (filter === 'all') {
                row.style.display = '';
            } else {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(filter.toLowerCase()) ? '' : 'none';
            }
        });
    }

    // Filter clients by contact age
    function filterClientsByAge(threshold, btn) {
        const tbody = document.getElementById('clients-list');
        if (!tbody) return;
        btn.parentElement.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const rows = tbody.querySelectorAll('tr');
        rows.forEach(row => {
            const age = parseFloat(row.getAttribute('data-contact-age'));
            if (threshold === 'all') {
                row.style.display = '';
            } else if (threshold === 'never') {
                row.style.display = (age === Infinity) ? '' : 'none';
            } else {
                row.style.display = (age > threshold) ? '' : 'none';
            }
        });
    }
    // ===== CLIENT PANEL =====
    function openClientPanel(clientName) {
        const client = DATA.clients.find(c => c.nom === clientName);
        if (!client) return;

        const nameLower = client.nom.toLowerCase();

        // Flexible matching for projets
        const clientProjets = (DATA.projets || []).filter(p => {
            const pClient = (p.client || '').toLowerCase();
            return pClient.includes(nameLower) || nameLower.includes(pClient);
        });

        // Flexible matching for devis
        const clientDevis = (DATA.devis || []).filter(d => {
            const dClient = (d.client || '').toLowerCase();
            return dClient.includes(nameLower) || nameLower.includes(dClient);
        });

        // Flexible matching for factures
        const clientFactures = (DATA.factures || []).filter(f => {
            const fClient = (f.client || '').toLowerCase();
            return fClient.includes(nameLower) || nameLower.includes(fClient);
        });

        // Use pre-computed CA from data
        const ca2025 = client.ca_2025 || 0;
        const ca2026 = client.ca_2026 || 0;
        const caTotal = client.ca_total || 0;
        const ca2025Fmt = Math.round(ca2025).toLocaleString('fr-FR');
        const ca2026Fmt = Math.round(ca2026).toLocaleString('fr-FR');

        // Contact info
        const tel = client.telephone || '';
        const email = client.email || '';
        const site = client.site || '--';
        const dc = client.dernier_contact || '--';
        const ageDays = clientContactAgeDays(client.dernier_contact);
        const dcColor = ageDays > 90 ? '#e74c3c' : (dc === '--' ? 'var(--text-light)' : 'var(--success)');

        // Projets list
        let projetsHtml = '';
        if (clientProjets.length === 0) {
            projetsHtml = '<div style="color:var(--text-light);font-size:0.88rem;">Aucun projet</div>';
        } else {
            projetsHtml = clientProjets.map(p =>
                '<div onclick="openProjetPanel(\'' + esc(p.nom).replace(/'/g, "\\'") + '\')" style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);cursor:pointer;" onmouseover="this.style.background=\'var(--bg)\'" onmouseout="this.style.background=\'transparent\'">' +
                    '<div><div style="font-weight:600;font-size:0.88rem;color:var(--primary);">' + esc(p.nom) + '</div><div style="font-size:0.78rem;color:var(--text-light);">' + esc(p.type) + ' — ' + fmtDate(p.deadline) + '</div></div>' +
                    '<span class="badge ' + badgeClass(p.statut) + '">' + esc(p.statut) + '</span>' +
                '</div>'
            ).join('');
        }

        // Devis list
        let devisHtml = '';
        if (clientDevis.length === 0) {
            devisHtml = '<div style="color:var(--text-light);font-size:0.88rem;">Aucun devis</div>';
        } else {
            devisHtml = clientDevis.map(d => {
                const pdfLink = d.pdf_url ? ' <a href="' + esc(d.pdf_url) + '" target="_blank" style="font-size:0.75rem;color:var(--primary);text-decoration:none;">PDF</a>' : '';
                return '<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);">' +
                    '<div><div style="font-weight:600;font-size:0.88rem;">' + esc(d.objet || d.nom) + pdfLink + '</div><div style="font-size:0.78rem;color:var(--text-light);">' + fmtDate(d.date_envoi || d.date) + '</div></div>' +
                    '<div style="text-align:right;"><div style="font-weight:600;font-size:0.88rem;">' + esc(d.montant) + '</div><span class="badge ' + badgeClass(d.statut) + '">' + esc(d.statut) + '</span></div>' +
                '</div>';
            }).join('');
        }

        // Factures list
        let facturesHtml = '';
        if (clientFactures.length === 0) {
            facturesHtml = '<div style="color:var(--text-light);font-size:0.88rem;">Aucune facture</div>';
        } else {
            facturesHtml = clientFactures.map(f => {
                const statutColor = f.statut === 'payee' ? 'var(--success)' : '#e74c3c';
                const statutBg = f.statut === 'payee' ? 'rgba(34,197,94,0.12)' : 'rgba(239,68,68,0.12)';
                const statutLabel = f.statut === 'payee' ? 'Payée' : 'Impayée';
                const pdfLink = f.pdf_url ? ' <a href="' + esc(f.pdf_url) + '" target="_blank" style="font-size:0.75rem;color:var(--primary);text-decoration:none;">PDF</a>' : '';
                return '<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid var(--border);">' +
                    '<div><div style="font-weight:600;font-size:0.88rem;">' + esc(f.opp_nom || f.objet || f.nom) + pdfLink + '</div><div style="font-size:0.78rem;color:var(--text-light);">' + fmtDate(f.date) + '</div></div>' +
                    '<div style="text-align:right;"><div style="font-weight:600;font-size:0.88rem;">' + esc(f.montant) + '</div><span style="display:inline-block;padding:2px 10px;border-radius:12px;font-size:0.75rem;font-weight:600;color:' + statutColor + ';background:' + statutBg + ';">' + statutLabel + '</span></div>' +
                '</div>';
            }).join('');
        }

        const siteHtml = site !== '--' ? '<a href="https://' + esc(site) + '" target="_blank" style="color:var(--primary);text-decoration:none;">' + esc(site) + '</a>' : '--';
        const telHtml = tel ? '<a href="tel:' + esc(tel) + '" style="color:var(--primary);text-decoration:none;">' + esc(tel) + '</a>' : '--';
        const emailHtml = email ? '<a href="mailto:' + esc(email) + '" style="color:var(--primary);text-decoration:none;">' + esc(email) + '</a>' : '--';

        // Entreprise info from Pennylane
        const nomEntreprise = client.nom_entreprise || null;
        const siret = client.siret || null;
        const adresse = client.adresse || null;
        const siretFmt = siret ? siret.replace(/(\d{3})(?=\d)/g, '$1 ').trim() : null;

        // Clean address (remove duplicates like "68100 MULHOUSE, 68100, MULHOUSE")
        let adresseClean = adresse;
        if (adresse) {
            const parts = adresse.split(',').map(function(p) { return p.trim(); });
            const seen = [];
            parts.forEach(function(p) { if (!seen.some(function(s) { return s.toLowerCase().includes(p.toLowerCase()) || p.toLowerCase().includes(s.toLowerCase()); })) seen.push(p); });
            adresseClean = seen.join(', ');
        }

        const sectionTitle = function(t) { return '<div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-weight:600;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);">' + t + '</div>'; };
        const infoRow = function(label, value) { return '<div style="display:flex;justify-content:space-between;padding:5px 0;font-size:0.85rem;"><span style="color:var(--text-light);font-weight:500;">' + label + '</span><span style="text-align:right;max-width:65%;">' + value + '</span></div>'; };

        document.getElementById('client-panel').innerHTML = '<div style="padding:0;">' +
            // Header
            '<div style="padding:20px 24px 16px;border-bottom:1px solid var(--border);background:var(--bg);">' +
                '<div style="display:flex;justify-content:space-between;align-items:start;">' +
                    '<div>' +
                        '<h2 style="font-size:1.2rem;font-weight:700;margin:0 0 2px;">' + esc(client.nom) + '</h2>' +
                        (nomEntreprise && nomEntreprise.toLowerCase() !== client.nom.toLowerCase() ? '<div style="font-size:0.8rem;color:var(--text-light);">' + esc(nomEntreprise) + '</div>' : '') +
                    '</div>' +
                    '<button onclick="closePanel()" style="background:none;border:none;cursor:pointer;font-size:1.3rem;color:var(--text-light);line-height:1;padding:4px 8px;">✕</button>' +
                '</div>' +
                (siretFmt ? '<div style="font-size:0.75rem;color:var(--text-light);margin-top:6px;">SIRET ' + esc(siretFmt) + '</div>' : '') +
                // CA badge
                '<div style="display:inline-block;margin-top:10px;padding:6px 16px;border-radius:8px;background:rgba(34,197,94,0.1);">' +
                    '<span style="font-size:0.75rem;color:var(--text-light);">CA 2025</span> ' +
                    '<span style="font-weight:700;font-size:1.05rem;color:var(--success);">' + ca2025Fmt + ' €</span>' +
                '</div>' +
            '</div>' +
            // Body
            '<div style="padding:20px 24px;">' +
                // Contact
                sectionTitle('Contact') +
                '<div style="margin-bottom:20px;">' +
                    infoRow('Tel', telHtml) +
                    infoRow('Email', emailHtml) +
                    (adresseClean ? infoRow('Adresse', '<span style="font-size:0.82rem;">' + esc(adresseClean) + '</span>') : '') +
                    infoRow('Site', siteHtml) +
                    infoRow('Dernier contact', '<span style="color:' + dcColor + ';font-weight:600;">' + fmtDate(dc) + '</span>') +
                '</div>' +
                // Projets
                sectionTitle('Projets (' + clientProjets.length + ')') +
                '<div style="margin-bottom:20px;">' + projetsHtml + '</div>' +
                // Devis
                sectionTitle('Devis (' + clientDevis.length + ')') +
                '<div style="margin-bottom:20px;">' + devisHtml + '</div>' +
                // Factures
                sectionTitle('Factures (' + clientFactures.length + ')') +
                '<div style="margin-bottom:20px;">' + facturesHtml + '</div>' +
                // Suivi
                sectionTitle('Suivi') +
                '<div style="margin-bottom:20px;">' +
                    ((client.suivi && client.suivi.length > 0) ? client.suivi.map(function(s) { return '<div style="padding:6px 0;border-bottom:1px solid var(--border);font-size:0.85rem;"><span style="color:var(--text-light);font-size:0.75rem;margin-right:8px;">' + fmtDate(s.date) + '</span>' + esc(s.note) + '</div>'; }).join('') : '<div style="color:var(--text-light);font-size:0.85rem;">Aucune note</div>') +
                '</div>' +
            '</div>' +
        '</div>';

        document.getElementById('client-panel').classList.add('open');
        document.getElementById('client-panel-overlay').classList.add('visible');
    }

    let clientSortCol = -1;
    let clientSortAsc = true;
    function sortClientsTable(colIdx, type, thEl) {
        const tbody = document.getElementById('clients-list');
        if (!tbody) return;
        if (clientSortCol === colIdx) { clientSortAsc = !clientSortAsc; } else { clientSortCol = colIdx; clientSortAsc = true; }
        // Update icons
        thEl.closest('tr').querySelectorAll('.sort-icon').forEach(function(s) { s.textContent = ''; });
        thEl.querySelector('.sort-icon').textContent = clientSortAsc ? ' ▲' : ' ▼';
        const rows = Array.from(tbody.querySelectorAll('tr'));
        rows.sort(function(a, b) {
            const cellA = a.cells[colIdx]; const cellB = b.cells[colIdx];
            if (!cellA || !cellB) return 0;
            let vA = cellA.textContent.trim(); let vB = cellB.textContent.trim();
            if (type === 'num') {
                const nA = parseFloat(vA.replace(/[^0-9,.-]/g, '').replace(',', '.')) || 0;
                const nB = parseFloat(vB.replace(/[^0-9,.-]/g, '').replace(',', '.')) || 0;
                return clientSortAsc ? nA - nB : nB - nA;
            } else if (type === 'date') {
                // Format JJ-MM-AAAA -> sortable
                const pA = vA.split('-'); const pB = vB.split('-');
                const dA = pA.length === 3 ? pA[2] + pA[1] + pA[0] : '00000000';
                const dB = pB.length === 3 ? pB[2] + pB[1] + pB[0] : '00000000';
                return clientSortAsc ? dA.localeCompare(dB) : dB.localeCompare(dA);
            } else {
                vA = vA.toLowerCase(); vB = vB.toLowerCase();
                return clientSortAsc ? vA.localeCompare(vB) : vB.localeCompare(vA);
            }
        });
        rows.forEach(function(r) { tbody.appendChild(r); });
    }

    // ===== PROJET PANEL =====
    function openProjetPanel(projetNom) {
        const projet = DATA.projets.find(function(p) { return p.nom === projetNom; });
        if (!projet) return;

        // Find associated client (flexible match)
        const projetClientLower = (projet.client || '').toLowerCase();
        const client = DATA.clients.find(function(c) {
            const cNom = (c.nom || '').toLowerCase();
            return cNom.includes(projetClientLower) || projetClientLower.includes(cNom);
        }) || null;

        const sectionTitle = function(t) { return '<div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-weight:600;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);">' + t + '</div>'; };
        const infoRow = function(label, value) { return '<div style="display:flex;justify-content:space-between;padding:5px 0;font-size:0.85rem;"><span style="color:var(--text-light);font-weight:500;">' + label + '</span><span style="text-align:right;max-width:65%;">' + value + '</span></div>'; };

        // Client info
        const tel = client ? (client.telephone || '') : '';
        const email = client ? (client.email || '') : '';
        const telHtml = tel ? '<a href="tel:' + esc(tel) + '" style="color:var(--primary);text-decoration:none;">' + esc(tel) + '</a>' : '--';
        const emailHtml = email ? '<a href="mailto:' + esc(email) + '" style="color:var(--primary);text-decoration:none;">' + esc(email) + '</a>' : '--';

        // Details from PROJET.md
        const details = projet.details || null;
        const urlHtml = details && details.url ? '<a href="' + esc(details.url) + '" target="_blank" style="color:var(--primary);text-decoration:none;">' + esc(details.url) + ' ↗</a>' : null;

        // Suivi notes (from client if available)
        const suivi = client && client.suivi && client.suivi.length > 0 ? client.suivi : [];

        // Client name clickable
        const clientNameHtml = client
            ? '<a href="javascript:void(0)" onclick="openClientPanel(\'' + esc(client.nom).replace(/'/g, "\\'") + '\')" style="color:var(--primary);text-decoration:none;font-weight:500;">' + esc(projet.client) + '</a>'
            : esc(projet.client);

        const panelHtml = '<div style="padding:0;">' +
            // Header
            '<div style="padding:20px 24px 16px;border-bottom:1px solid var(--border);background:var(--bg);">' +
                '<div style="display:flex;justify-content:space-between;align-items:start;">' +
                    '<div>' +
                        '<h2 style="font-size:1.2rem;font-weight:700;margin:0 0 4px;">' + esc(projet.nom) + '</h2>' +
                        '<div style="font-size:0.85rem;color:var(--text-light);">' + clientNameHtml + '</div>' +
                    '</div>' +
                    '<button onclick="closePanel()" style="background:none;border:none;cursor:pointer;font-size:1.3rem;color:var(--text-light);line-height:1;padding:4px 8px;">✕</button>' +
                '</div>' +
                '<div style="margin-top:10px;"><span class="badge ' + badgeClass(projet.statut) + '">' + esc(projet.statut) + '</span></div>' +
            '</div>' +
            // Body
            '<div style="padding:20px 24px;">' +
                // Infos
                sectionTitle('Infos') +
                '<div style="margin-bottom:20px;">' +
                    infoRow('Type', esc(projet.type)) +
                    infoRow('Deadline', esc(projet.deadline || '--')) +
                    (urlHtml ? infoRow('URL', urlHtml) : '') +
                    (details && details.activite ? infoRow('Activité', esc(details.activite)) : '') +
                '</div>' +
                // Client
                sectionTitle('Client') +
                '<div style="margin-bottom:20px;">' +
                    infoRow('Nom', clientNameHtml) +
                    infoRow('Tel', telHtml) +
                    infoRow('Email', emailHtml) +
                '</div>' +
                // Details (PROJET.md notes)
                (details && details.notes ?
                    sectionTitle('Details') +
                    '<div style="margin-bottom:20px;">' +
                        '<pre style="font-size:0.82rem;font-family:Inter,sans-serif;white-space:pre-wrap;word-break:break-word;color:var(--text);line-height:1.6;margin:0;padding:12px;background:var(--bg);border-radius:8px;border:1px solid var(--border);">' + esc(details.notes) + '</pre>' +
                    '</div>'
                : '') +
                // Suivi
                sectionTitle('Suivi') +
                '<div style="margin-bottom:20px;">' +
                    (suivi.length > 0
                        ? suivi.map(function(s) { return '<div style="padding:6px 0;border-bottom:1px solid var(--border);font-size:0.85rem;"><span style="color:var(--text-light);font-size:0.75rem;margin-right:8px;">' + fmtDate(s.date) + '</span>' + esc(s.note) + '</div>'; }).join('')
                        : '<div style="color:var(--text-light);font-size:0.85rem;">Aucune note</div>') +
                '</div>' +
            '</div>' +
        '</div>';

        document.getElementById('client-panel').innerHTML = panelHtml;
        document.getElementById('client-panel').classList.add('open');
        document.getElementById('client-panel-overlay').classList.add('visible');
    }

    function openTachePanel(titre) {
        const tache = DATA.taches.find(function(t) { return t.titre === titre; });
        if (!tache) return;

        const statutMap = { a_faire: 'A faire', en_cours: 'En cours', termine: 'Termine', bloque: 'Bloque' };
        const statutColors = { a_faire: 'badge-blue', en_cours: 'badge-orange', termine: 'badge-green', bloque: 'badge-red' };
        const statutLabel = statutMap[tache.colonne] || tache.colonne;
        const statutBadge = statutColors[tache.colonne] || 'badge-gray';

        const sectionTitle = function(t) { return '<div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-weight:600;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);">' + t + '</div>'; };
        const infoRow = function(label, value) { return '<div style="display:flex;justify-content:space-between;padding:5px 0;font-size:0.85rem;"><span style="color:var(--text-light);font-weight:500;">' + label + '</span><span style="text-align:right;max-width:65%;">' + value + '</span></div>'; };

        document.getElementById('client-panel').innerHTML = '<div style="padding:0;">' +
            '<div style="padding:20px 24px 16px;border-bottom:1px solid var(--border);background:var(--bg);">' +
                '<div style="display:flex;justify-content:space-between;align-items:start;">' +
                    '<div style="flex:1;">' +
                        '<h2 style="font-size:1.2rem;font-weight:700;margin:0 0 8px;">' + esc(tache.titre) + '</h2>' +
                        '<span class="badge ' + statutBadge + '">' + esc(statutLabel) + '</span>' +
                    '</div>' +
                    '<button onclick="closePanel()" style="background:none;border:none;cursor:pointer;font-size:1.3rem;color:var(--text-light);line-height:1;padding:4px 8px;">✕</button>' +
                '</div>' +
            '</div>' +
            '<div style="padding:20px 24px;">' +
                sectionTitle('Details') +
                '<div style="margin-bottom:20px;">' +
                    infoRow('Type', '<span class="badge badge-' + (tache.badge_color || 'gray') + '">' + esc(tache.badge || '--') + '</span>') +
                    (tache.desc ? infoRow('Description', esc(tache.desc)) : '') +
                '</div>' +
                sectionTitle('Suivi') +
                '<div style="margin-bottom:20px;">' +
                    ((tache.suivi && tache.suivi.length > 0) ? tache.suivi.map(function(s) { return '<div style="padding:6px 0;border-bottom:1px solid var(--border);font-size:0.85rem;"><span style="color:var(--text-light);font-size:0.75rem;margin-right:8px;">' + fmtDate(s.date) + '</span>' + esc(s.note) + '</div>'; }).join('') : '<div style="color:var(--text-light);font-size:0.85rem;">Aucune note</div>') +
                '</div>' +
            '</div>' +
        '</div>';

        document.getElementById('client-panel').classList.add('open');
        document.getElementById('client-panel-overlay').classList.add('visible');
    }

    // ===== TACHE PANEL =====
    function openTachePanel(tacheTitle) {
        const tache = DATA.taches.find(function(t) { return t.titre === tacheTitle; });
        if (!tache) return;

        const sectionTitle = function(t) { return '<div style="font-size:0.7rem;text-transform:uppercase;letter-spacing:1px;color:var(--text-light);font-weight:600;margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid var(--border);">' + t + '</div>'; };
        const infoRow = function(label, value) { return '<div style="display:flex;justify-content:space-between;padding:5px 0;font-size:0.85rem;"><span style="color:var(--text-light);font-weight:500;">' + label + '</span><span style="text-align:right;max-width:65%;">' + value + '</span></div>'; };

        const colonneLabels = { a_faire: 'À faire', en_cours: 'En cours', termine: 'Terminé', bloque: 'Bloqué' };
        const statutLabel = colonneLabels[tache.colonne] || tache.colonne;

        // Try to find related projet or client
        const titreLower = tache.titre.toLowerCase();
        const relatedProjet = DATA.projets.find(function(p) {
            return p.client.toLowerCase().includes(titreLower) || titreLower.includes(p.client.toLowerCase()) || p.nom.toLowerCase().includes(titreLower) || titreLower.includes(p.nom.toLowerCase());
        });
        const relatedClient = relatedProjet ? DATA.clients.find(function(c) {
            const cNom = c.nom.toLowerCase();
            const pClient = relatedProjet.client.toLowerCase();
            return cNom.includes(pClient) || pClient.includes(cNom);
        }) : null;

        const relatedHtml = relatedProjet
            ? '<a href="javascript:void(0)" onclick="openProjetPanel(\'' + esc(relatedProjet.nom).replace(/'/g, "\\'") + '\')" style="color:var(--primary);text-decoration:none;font-weight:500;">' + esc(relatedProjet.nom) + '</a>'
            : null;

        const panelHtml = '<div style="padding:0;">' +
            // Header
            '<div style="padding:20px 24px 16px;border-bottom:1px solid var(--border);background:var(--bg);">' +
                '<div style="display:flex;justify-content:space-between;align-items:start;">' +
                    '<div>' +
                        '<h2 style="font-size:1.2rem;font-weight:700;margin:0 0 4px;">' + esc(tache.titre) + '</h2>' +
                        (tache.badge ? '<div style="font-size:0.85rem;color:var(--text-light);">' + esc(tache.badge) + '</div>' : '') +
                    '</div>' +
                    '<button onclick="closePanel()" style="background:none;border:none;cursor:pointer;font-size:1.3rem;color:var(--text-light);line-height:1;padding:4px 8px;">✕</button>' +
                '</div>' +
                '<div style="margin-top:10px;"><span class="badge ' + badgeClass(statutLabel) + '">' + esc(statutLabel) + '</span></div>' +
            '</div>' +
            // Body
            '<div style="padding:20px 24px;">' +
                // Details
                sectionTitle('Détails') +
                '<div style="margin-bottom:20px;">' +
                    (tache.desc ? infoRow('Description', esc(tache.desc)) : '') +
                    infoRow('Colonne', esc(statutLabel)) +
                    (tache.badge ? infoRow('Type', '<span class="badge badge-' + (tache.badge_color || 'blue') + '">' + esc(tache.badge) + '</span>') : '') +
                    (tache.date ? infoRow('Date', fmtDate(tache.date)) : '') +
                    (tache.priorite ? infoRow('Priorité', esc(tache.priorite)) : '') +
                '</div>' +
                // Projet lié
                (relatedHtml ?
                    sectionTitle('Projet lié') +
                    '<div style="margin-bottom:20px;">' + infoRow('Projet', relatedHtml) + '</div>'
                : '') +
                // Suivi
                sectionTitle('Suivi') +
                '<div style="margin-bottom:20px;">' +
                    ((tache.suivi && tache.suivi.length > 0)
                        ? tache.suivi.map(function(s) { return '<div style="padding:6px 0;border-bottom:1px solid var(--border);font-size:0.85rem;"><span style="color:var(--text-light);font-size:0.75rem;margin-right:8px;">' + fmtDate(s.date) + '</span>' + esc(s.note) + '</div>'; }).join('')
                        : '<div style="color:var(--text-light);font-size:0.85rem;">Aucune note</div>') +
                '</div>' +
            '</div>' +
        '</div>';

        document.getElementById('client-panel').innerHTML = panelHtml;
        document.getElementById('client-panel').classList.add('open');
        document.getElementById('client-panel-overlay').classList.add('visible');
    }

    function closePanel() {
        document.getElementById('client-panel').classList.remove('open');
        document.getElementById('client-panel-overlay').classList.remove('visible');
    }
    // Backwards compat alias
    function closeClientPanel() { closePanel(); }

    // ===== SESSION PROSPECTION (Power Hour) =====
    let sessionState = {
        active: false,
        prospects: [],
        currentIndex: 0,
        results: [],
        startTime: null,
        sessionSize: 15
    };

    function startSession() {
        // Priorite: A rappeler d'abord, puis A contacter
        const hasTel = p => p.telephone && p.telephone.trim() !== '';
        const rappeler = DATA.prospects.filter(p => hasTel(p) && p.etape && p.etape.includes('rappeler'));
        const aContacter = DATA.prospects.filter(p => hasTel(p) && p.etape && p.etape.includes('contacter'));
        const allProspects = [...rappeler, ...aContacter];

        if (allProspects.length === 0) {
            alert('Aucun prospect a contacter !');
            return;
        }

        sessionState.active = true;
        sessionState.prospects = allProspects.slice(0, sessionState.sessionSize);
        sessionState.currentIndex = 0;
        sessionState.results = [];
        sessionState.startTime = Date.now();

        document.getElementById('session-overlay').style.display = 'flex';
        document.body.style.overflow = 'hidden';
        renderSessionCard();
    }

    function endSession() {
        sessionState.active = false;
        document.getElementById('session-overlay').style.display = 'none';
        document.body.style.overflow = '';
    }

    function renderSessionCard() {
        const overlay = document.getElementById('session-overlay');
        const idx = sessionState.currentIndex;
        const total = sessionState.prospects.length;

        // Session terminee ?
        if (idx >= total) {
            renderSessionRecap();
            return;
        }

        const p = sessionState.prospects[idx];
        const prenom = p.contact ? p.contact.split(' ')[0] : 'le responsable';
        const elapsed = Math.floor((Date.now() - sessionState.startTime) / 60000);
        const remaining = DATA.prospects.filter(pr => pr.etape && (pr.etape.includes('contacter') || pr.etape.includes('rappeler'))).length - idx;
        const isRappel = p.etape && p.etape.includes('rappeler');

        overlay.innerHTML = `
        <div class="session-container">
            <div class="session-top">
                <div class="session-counter">Appel ${idx + 1}/${total} &middot; ${elapsed} min &middot; Reste ${remaining} prospects</div>
                <button class="session-close" onclick="endSession()">&times;</button>
            </div>

            ${isRappel ? '<div class="session-rappel-badge">RAPPEL</div>' : ''}

            <div class="session-company">${esc(p.entreprise)}</div>
            <div class="session-contact">${esc(p.contact || '--')}</div>
            <div class="session-meta">${esc(p.secteur || '')} ${p.ville ? '&middot; ' + esc(p.ville) : ''}</div>

            <a href="tel:${esc((p.telephone || '').replace(/\s/g, ''))}" class="session-phone-btn">
                📞 ${esc(p.telephone || 'Pas de tel')}
            </a>

            ${p.site_web ? '<a href="' + esc(p.site_web) + '" target="_blank" class="session-site-link">🌐 Voir le site</a>' : ''}

            <div class="session-script">
                <div class="script-toggle" onclick="this.parentElement.classList.toggle('collapsed')" style="display:flex;justify-content:space-between;align-items:center;cursor:pointer;margin-bottom:8px;">
                    <span style="font-size:0.75rem;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-light);">Script d'appel</span>
                    <span class="script-arrow" style="font-size:0.7rem;color:var(--text-light);transition:transform 0.2s;">▼</span>
                </div>
                <div class="script-body">
                <div class="script-section">
                    <div class="script-label">ACCROCHE</div>
                    <div class="script-text">"Bonjour, je souhaiterais parler a ${esc(prenom)} s'il vous plait"</div>
                </div>
                <div class="script-section">
                    <div class="script-label">SI "C'EST POUR QUOI ?"</div>
                    <div class="script-text">"Je suis Akli, de Pixel Drop. On accompagne les entreprises ${p.secteur ? 'du ' + esc(p.secteur) : ''} a gagner en productivite grace a l'IA. Je voulais echanger rapidement avec ${esc(prenom)}."</div>
                </div>
                <div class="script-section">
                    <div class="script-label">SI BARRAGE</div>
                    <div class="script-text">"C'est tres rapide, c'est au sujet de l'intelligence artificielle et de la productivite de l'entreprise"</div>
                </div>
                <div class="script-section">
                    <div class="script-label">SI BON INTERLOCUTEUR</div>
                    <div class="script-text">"Bonjour ${esc(prenom)}, je suis Akli de Pixel Drop. On aide les entreprises comme la votre a gagner du temps grace a l'IA. Est-ce que vous avez commence a l'integrer dans votre activite ?"</div>
                </div>
                </div>
            </div>

            <input type="text" class="session-note-input" id="session-note" placeholder="Note rapide (optionnel)..." />

            <div class="session-buttons">
                <button class="session-btn btn-no-answer" onclick="sessionAction('pas_repondu')">
                    <span class="btn-key">1</span>
                    <span>Pas de reponse</span>
                </button>
                <button class="session-btn btn-not-interested" onclick="sessionAction('pas_interesse')">
                    <span class="btn-key">2</span>
                    <span>Pas interesse</span>
                </button>
                <button class="session-btn btn-callback" onclick="sessionAction('rappeler')">
                    <span class="btn-key">3</span>
                    <span>A rappeler</span>
                </button>
                <button class="session-btn btn-interested" onclick="sessionAction('interesse')">
                    <span class="btn-key">4</span>
                    <span>Interesse / RDV</span>
                </button>
            </div>
        </div>`;
    }

    function sessionAction(action) {
        const p = sessionState.prospects[sessionState.currentIndex];
        const note = document.getElementById('session-note') ? document.getElementById('session-note').value.trim() : '';

        sessionState.results.push({
            entreprise: p.entreprise,
            contact: p.contact,
            telephone: p.telephone,
            action: action,
            note: note
        });

        // Update prospect etape in local DATA
        const idx = DATA.prospects.findIndex(pr => pr.entreprise === p.entreprise && pr.telephone === p.telephone);
        if (idx !== -1) {
            if (action === 'pas_interesse') DATA.prospects[idx].etape = '❌ Pas intéressé';
            else if (action === 'rappeler') DATA.prospects[idx].etape = '🔄 À rappeler';
            else if (action === 'interesse') DATA.prospects[idx].etape = '✅ Intéressé';
            else if (action === 'pas_repondu') DATA.prospects[idx].etape = '📵 Pas répondu';
        }

        sessionState.currentIndex++;
        renderSessionCard();
    }

    function renderSessionRecap() {
        const overlay = document.getElementById('session-overlay');
        const elapsed = Math.floor((Date.now() - sessionState.startTime) / 60000);
        const results = sessionState.results;

        const pasRepondu = results.filter(r => r.action === 'pas_repondu').length;
        const pasInteresse = results.filter(r => r.action === 'pas_interesse').length;
        const rappeler = results.filter(r => r.action === 'rappeler').length;
        const interesse = results.filter(r => r.action === 'interesse').length;

        // Build text summary for Claudia
        let summary = `SESSION PROSPECTION ${new Date().toLocaleDateString('fr-FR')}\n`;
        summary += `${results.length} appels en ${elapsed} min\n\n`;
        results.forEach((r, i) => {
            let status = '';
            if (r.action === 'pas_repondu') status = 'Pas repondu';
            if (r.action === 'pas_interesse') status = 'Pas interesse';
            if (r.action === 'rappeler') status = 'A rappeler';
            if (r.action === 'interesse') status = 'INTERESSE';
            summary += `${i+1}. ${r.entreprise} (${r.contact}) - ${status}`;
            if (r.note) summary += ` - Note: ${r.note}`;
            summary += `\n`;
        });
        summary += `\nRESUME: ${pasRepondu} pas repondu, ${pasInteresse} pas interesse, ${rappeler} a rappeler, ${interesse} interesse`;

        // Save to localStorage
        const sessions = JSON.parse(localStorage.getItem('prospection_sessions') || '[]');
        sessions.push({
            date: new Date().toISOString(),
            results: results,
            duration: elapsed
        });
        localStorage.setItem('prospection_sessions', JSON.stringify(sessions));
        localStorage.setItem('last_session_summary', summary);

        overlay.innerHTML = `
        <div class="session-container">
            <div class="session-top">
                <div class="session-counter">Session terminee - ${elapsed} min</div>
                <button class="session-close" onclick="endSession(); renderProspection();">&times;</button>
            </div>

            <div class="session-company" style="font-size:1.4rem;margin-top:20px;">Session terminee !</div>

            <div class="recap-grid">
                <div class="recap-card">
                    <div class="recap-number">${results.length}</div>
                    <div class="recap-label">Appels</div>
                </div>
                <div class="recap-card">
                    <div class="recap-number">${pasRepondu}</div>
                    <div class="recap-label">Pas repondu</div>
                </div>
                <div class="recap-card">
                    <div class="recap-number">${pasInteresse}</div>
                    <div class="recap-label">Pas interesse</div>
                </div>
                <div class="recap-card">
                    <div class="recap-number" style="color:var(--warning)">${rappeler}</div>
                    <div class="recap-label">A rappeler</div>
                </div>
                <div class="recap-card">
                    <div class="recap-number" style="color:var(--success)">${interesse}</div>
                    <div class="recap-label">Interesse</div>
                </div>
            </div>

            <div class="recap-details">
                ${results.map((r, i) => {
                    let icon = '';
                    if (r.action === 'pas_repondu') icon = '📵';
                    if (r.action === 'pas_interesse') icon = '❌';
                    if (r.action === 'rappeler') icon = '🔄';
                    if (r.action === 'interesse') icon = '✅';
                    return `<div class="recap-row">${icon} ${esc(r.entreprise)}${r.note ? ' <span style="color:var(--text-light);font-size:0.8rem;">- ' + esc(r.note) + '</span>' : ''}</div>`;
                }).join('')}
            </div>

            <button class="session-send-btn" onclick="copySessionSummary()">
                📋 Copier le resume pour Claudia
            </button>

            <div class="session-buttons" style="margin-top:12px;">
                <button class="session-btn btn-callback" onclick="endSession(); renderProspection(); startSession();" style="flex:1;">
                    Encore ${sessionState.sessionSize} appels
                </button>
                <button class="session-btn btn-no-answer" onclick="endSession(); renderProspection();" style="flex:1;">
                    Terminer
                </button>
            </div>
        </div>`;
    }

    function copySessionSummary() {
        const summary = localStorage.getItem('last_session_summary') || '';
        navigator.clipboard.writeText(summary).then(() => {
            const btn = document.querySelector('.session-send-btn');
            if (btn) {
                btn.textContent = '✅ Copie ! Colle sur iMessage';
                btn.style.background = 'var(--success)';
                setTimeout(() => {
                    btn.textContent = '📋 Copier le resume pour Claudia';
                    btn.style.background = '';
                }, 2000);
            }
        });
    }

    // Raccourcis clavier 1-2-3-4
    document.addEventListener('keydown', function(e) {
        if (!sessionState.active) return;
        if (sessionState.currentIndex >= sessionState.prospects.length) return;
        if (document.activeElement && document.activeElement.tagName === 'INPUT') return;

        if (e.key === '1') sessionAction('pas_repondu');
        else if (e.key === '2') sessionAction('pas_interesse');
        else if (e.key === '3') sessionAction('rappeler');
        else if (e.key === '4') sessionAction('interesse');
    });

    // === CLAUDIA DYNAMIC SYNC ===
    function loadClaudiaStatus() {
        fetch('./claudia-status.json?' + Date.now()) // Cache busting
            .then(response => {
                if (!response.ok) throw new Error('Status file not found');
                return response.json();
            })
            .then(data => {
                updateHeartbeats(data.heartbeats);
                updateRecentActivity(data.recentActivity);
                updateTokenUsage(data.tokenUsage);
            })
            .catch(error => {
                console.warn('Claudia sync error:', error);
                // Afficher des placeholders si pas de données
                document.getElementById('recent-activity').innerHTML = 
                    '<div style="color: var(--text-light); font-size: 0.9rem; text-align: center; padding: 20px;">Sync en cours...</div>';
            });
    }

    function updateHeartbeats(heartbeats) {
        if (!heartbeats) return;

        // Mettre à jour les indicateurs "dernier check"
        if (heartbeats.main && heartbeats.main.lastCheck) {
            const mainElement = document.getElementById('main-last-check');
            if (mainElement) {
                const minutesAgo = calculateMinutesAgo(heartbeats.main.lastCheck);
                mainElement.textContent = `Dernier check : il y a ${minutesAgo}min`;
            }
        }

        if (heartbeats['plaza-marketing'] && heartbeats['plaza-marketing'].lastCheck) {
            const plazaElement = document.getElementById('plaza-last-check');
            if (plazaElement) {
                const minutesAgo = calculateMinutesAgo(heartbeats['plaza-marketing'].lastCheck);
                plazaElement.textContent = `Dernier check : il y a ${minutesAgo}min`;
            }
        }

        if (heartbeats.clea && heartbeats.clea.lastCheck) {
            const cleaElement = document.getElementById('clea-last-check');
            if (cleaElement) {
                const minutesAgo = calculateMinutesAgo(heartbeats.clea.lastCheck);
                cleaElement.textContent = `Dernier check : il y a ${minutesAgo}min`;
            }
        }
    }

    function updateRecentActivity(activities) {
        const container = document.getElementById('recent-activity');
        if (!activities || activities.length === 0) {
            container.innerHTML = '<div style="color: var(--text-light); font-size: 0.9rem; text-align: center; padding: 20px;">Aucune activité récente</div>';
            return;
        }

        let html = '';
        activities.slice(0, 8).forEach(activity => {
            const agentClass = activity.agent.toLowerCase() === 'claudia' ? 'agent-claudia' : 
                              activity.agent.toLowerCase() === 'valentina' ? 'agent-valentina' : 
                              'agent-clea';
            
            html += `
                <div class="activity-item">
                    <div class="activity-time">${activity.time}</div>
                    <div class="activity-agent ${agentClass}">${activity.agent}</div>
                    <div class="activity-action">${activity.action}</div>
                </div>
            `;
        });

        container.innerHTML = html;
    }

    function updateTokenUsage(tokenUsage) {
        if (!tokenUsage || !tokenUsage.today) return;

        const inputEl = document.getElementById('tokens-input');
        const outputEl = document.getElementById('tokens-output');
        const costEl = document.getElementById('tokens-cost');
        const messagesEl = document.getElementById('messages-sent');

        if (inputEl) inputEl.textContent = formatNumber(tokenUsage.today.input);
        if (outputEl) outputEl.textContent = formatNumber(tokenUsage.today.output);
        if (costEl) costEl.textContent = '$' + (tokenUsage.today.cost || 0).toFixed(2);
        if (messagesEl) messagesEl.textContent = '--'; // Placeholder pour messages
    }

    function calculateMinutesAgo(isoDateString) {
        if (!isoDateString || isoDateString === 'unknown') return '--';
        try {
            const then = new Date(isoDateString);
            const now = new Date();
            const diffMs = now - then;
            const diffMinutes = Math.floor(diffMs / 60000);
            return diffMinutes;
        } catch (e) {
            return '--';
        }
    }

    function formatNumber(num) {
        if (!num) return '0';
        return num.toLocaleString();
    }

    // Charger les données au démarrage et toutes les 5 minutes
    if (currentTab === 'claudia') {
        loadClaudiaStatus();
        setInterval(loadClaudiaStatus, 5 * 60 * 1000); // 5 minutes
    }
</script>

<div class="session-overlay" id="session-overlay"></div>
<div class="client-panel-overlay" id="client-panel-overlay" onclick="closePanel()"></div>
<div class="client-panel" id="client-panel"></div>
</body>
</html>
